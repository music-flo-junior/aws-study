# VPC

사용자가 정의하는 IP 주소 범위 선택, 서브넷 생성, 라우팅 테이블 및 네트워크 게이트웨이 구성 등 가상 네트워크 환경을 VPC라고 한다.

## Amazon VPC
Amazon VPC는 클라우드 내 프라이빗 공간을 제공한다. VPC를 생성하면 클라우드에 기업 전용 데이터 센터를 구축할 수 있게 된다.

### CIDR
VPC 생성의 첫 번째 단계는 CIDR 블록을 이용한 CIDR 범위 결정이다. 
1. VPC는 IPv4, IPv6 모두 지원하는데 IPv4를 선택하면 /16사이의 범위, /28사이의 범위를 사용 할 수 있다.
``` 
/28 -> 16개 32-28 = 4, 2의 4승   
/27 -> 32개 32-27 = 5, 2의 5승
/26 -> 64개 32-26 = 6, 2의 6승
            .
            .
            .
/16 -> 65,536개 32-16 = 16, 2의 16승
```
2. IPv6 주소의 범위는 선택할 수는 없으며, 아마존에 의해 자동으로 할당 된다.
3. 한번 생성된 VPC는 주소의 크기를 변경할 수 없다.

### 서브넷
서브넷은 서브네트워크의 줄임말로 IP 네트워크의 논리적인 하위 부분을 가리킨다. VPC의 CIDR 블록을 이용해 서브넷을 정의할 수 있다.
1. 정의할 수 있는 최소 크기의 서브넷은 /28이며 16개의 IP주소를 생성할 수 있다.
2. 서브넷은 AZ당 하나만 사용할 수 있고, 여러개의 AZ에 연결되는 서브넷은 만들 수 없다.
3. VPC는 리전 단위로 생성된다.

#### 라우트 테이블
라우트 테이블은 트래픽의 전송 방향을 결정하는 라우트와 관련된 규칙을 담은 테이블이다. 목적지를 향한 최적의 경로로 데이터 패킷을 정송하기 위한 모든 정보를 담고 있다.
1. 특정 VPC의 서브넷이 라우트 테이블에 인터넷 게이트웨이를 포함하고 있으면 인터넷 엑세스 권한 및 정보를 가진다. 반대로 게이트웨이 정보가 없으면 인터넷에 접속 할 수 없다
2. 각각의 서브넷은 항상 라우트 테이블을 지니고 있어야 한다. 하나의 라우트 테이블 규칙을 여러 개의 서브넷에 연결하는 것은 가능하다.
3. VPC의 기본 라우트 테이블(메인 라우트 테이블)은 자동으로 생성되며 내용을 수정할 수 없다.

#### 인터넷 게이트웨이
1. VPC에 IG를 붙이면 라우트 테이블에 정의된 IG를 통해 서브넷에서 인터넷으로 바로 연결 할 수 있다.
2. VPC에 IG를 붙이는 방법은 라우트 테이블에 IG에 관련된 엔트리만 추가하면 된다.

#### NAT
NAT를 디바이스를 이용하면 프라이빗 서브넷에 있는 서버 인스턴스를 인터넷에 연결 할 수 있다.
1. NAT 기기는 IPv4 트래픽에서만 사용 할 수 있고 IPv6는 사용할 수 없다.
2. NAT 인스턴스, NAT 게이트웨이로 두가지 타입이다.

#### 일래스틱 IP 주소
흔히 고정적 IP라고도 불리우는데, ec2를 생성할때마다 새로운 IP 주소가 만들어 지므로 이러한 문제를 해결하기 위해 제공해준다.

#### 시큐리티 그룹
가상 방화벽과 같으며, 특정 인스턴스의 내부 또는 외부로 이동하는 트래픽을 정의한다.
1. 시큐리티 그룹은 인스턴스 단위로 할당된다.
2. 인스턴스 별로 최대 5개의 시큐리티 그룹을 부여 할 수 있고, 다른 인스턴스에 동일한 시큐리티 그룹을 부여할 수도 있다.

#### Amazon VPC 피어링
VPC 피어링은 하나의 VPC 피어링을 또 다른 VPC에 연결 한다.
1. AWS 서비스 중에는 VPC 외부에서 실행 되는 것들이 많다.

#### Transit Gateway
Transit Gateway를 이용하면 네트워크 전송 허브를 통해 VPC와 온프레미스 네트워크를 연결 할 수 있다.