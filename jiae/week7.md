# 7. AWS 애플리케이션 배포 및 모니터링

# 7.1 서버리스 서비스

## 7.1.1 서버리스 어플리케이션 개요

- 인프라 관리 필요성 없음
- 확장성
- 내재된 중복 구현성 (고가용성)
- 사용량에 따른 과금

Amazon S3, DynamoDB, API Gateway, Lambda, SNS와 SQS, CloudWatch, Kinesis 등이 서버리스 어플리케이션에 해당한다.

서버리스를 사용하면 개발자가 부담해야 할 프로비저닝, 유지보수, 안정화 관리, 장애대응 등 다양한 업무 대상이 되는 서버가 없다. (보이지 않는다.)

## 7.1.2 AWS Lambda

- AWS Lambda에 백엔드 코드를 업로드하면, 코드 실행에 필요한 용량 및 확장성 관리, 패치 업무, 인프라 관리 업무 등 자동으로 서버 관련 업무를 처리하며, 처리 결과로 생성된 성능 지표는 CloudWatch에 전송하여, 개발자는 오직 코드 작성 업무만 집중하면 된다.
- AWS Lambda에서 실행되는 코드를 Lambd 함수라고 하며, 개발자는 자신이 작성한 코드를 zip 파일 형식으로 업로드하거나 AWS 관리 콘솔에 자신만의 통합 개발 환경을 구축할 수 있다.
- 함수의 요청 횟수 및 코드 실행의 지속 시간에 따른 비용만 부담한다.
- 코드를 실행하지 않을 때는 요금이 발생하지 않는다.
- 사용자는 다수의 Lambda 함수를 병렬적으로 실행할 수 있으며, Lambda 함수는 상태 정보를 저장하지 않는 스테이트리스 속성을 지니므로 필요한만큼 함수를 복제해 실행할 수 있다.

## 7.1.2.1 AWS Lambda를 활용하기 위한 기본적인 단계

1. 먼저 AWS Lambda에 ZIP 포맷의 코드를 업로드한다. 혹은 직접 코드를 작성하거나 서버리스 어플리케이션 코드 저장소에서 샘플 코드를 가져온다.
2. 함수에 IAM 롤을 추가하거나 함수에 필요한 새 롤을 생성한다.
3. 함수를 생성한 뒤 Lambda 함수를 호출하기 위한 트리거를 추가한다.
4. Lambda 함수가 비동기적으로 호출되거나 함수가 스트리밍 데이터를 처리하면 목적지에 호출 기록을 전송하도록 목적지의 환경을 설정한다.
5. Lambda 함수가 생성되면 해당 함수가 어느 정도의 주기로 실행될지 설정할 수 있다. 또한 해당 함수가 이벤트에 의해 실행될지 여부 및 이벤트 소스의 내용도 설정할 수 있다.
6. 사용자는 이벤트 처리를 위한 컴퓨트 리소스, 이벤트 타임아웃, VPC 세부 사항 등 Lamda 함수에 대한 다양한 환경 요소를 설정할 수 있다.

## 7.1.2.2 Lambda가 지원하는 언어

Java, Node.js, Python, C#, Go, PowerShell, Ruby

추가적인 프로그래밍 언어를 지원하는 런타임 API를 제공한다.

## 7.1.2.3 AWS Lambda의 호출 별 리소스 용량 제한

## 7.1.2.4 Lambda 사용 패턴

- 실시간 파일 데이터 처리
- 실시간 스트림 데이터 처리
- ETL(Extract, Transform, Load) 작업
- Cron 대체
- AWS Events 처리

## 7.1.3 API Gateway

- Amazon API Gateway는 API 정의, 퍼블리싱, 배포, 유지, 모니터링, 확장에 이르는 모든 업무를 안전하게 처리할 수 있도록 하는 완전 관리형 API 서비스이다.

### 7.1.3.1 API Gateway 중요 활용 방식

- 백엔드 HTTP 엔드포인트, AWS Lambda 함수 또는 기타 AWS 서비스에 연결하기 위한 레스트풀 API의 생성, 배포, 관리
- 프론트엔드 HTTP 엔드포인트를 통해 외부로 노출된 API 호출
- 접근 권한 부여 및 접근 제어, 트래픽 모니터링, 버전 컨트롤 업무 수행
- API 호출 및 전송된 데이터 양에 따라 비용 지불

### 7.1.3.2 API Gateway가 지원하는 API 유형

- REST API
- WebSocket API
- HTTP API

### 7.1.3.3 Amazon API Gateway의 장점

- 높은 성능 및 장애 대응성
- 캐싱 기능
- 보안성
- 이용량 측정
- 모니터링
- 라이프 사이클 관리
- 다른 AWS 서비스와의 통합
- Open API 명세서(Swagger) 지원
- iOS, Android, JavaScript 용 SDK 지원

## 7.1.4 Kinesis

### 7.1.4.1 실시간 스트리밍 데이터 처리란?

### 실시간 애플리케이션 시나리오

- 배치 분석에서 스트리밍 분석으로 진화
    - 배치 프로세싱: 전통적인 데이터 분석 방식. 데이터 레이크에 쌓인 상태에서 한꺼번에 처리
    - 스트리밍 프로세싱: 실시간으로 흘러가는 데이터를 지속적으로 분석하는 방식
- 실시간 어플리케이션 개발
    - 스트리밍 데이터 서비스는 어플리케이션 모니터링, 사기 행동 감지, 라이브 리더보드 등 실시간 애플리케이션에 사용

### 배치 데이터 처리와 스트리밍 데이터 처리의 차이점

- 배치 분석의 경우 데이터 수집, 데이터베이스 입력, 분석까지 적게는 수시간, 많게는 수 주의 시간이 소요되는 일고라 처리 방식 사용
- 스트리밍 데이터는 데이터베이스에 저장된 데이터를 쿼리하는 방식이 아닌 실시간으로 이벤트를 처리한다. 실시간 데이터 분석서비스인 Amazon Kinesis는 이와 같이 대량으로 데이터를 효과적으로 처리한다.

### 7.1.4.2 Amazon Kinesis Data Streams

- 특화된 분석 목적에 맞춰 스트리밍 데이터에 대한 실시간 분석 서비스 제공

**Amazon Kinesis Data Streams 장점**

- 실시간성
    - 실시간 데이터 처리
- 안전성
    - VPC 엔드포인트 사용, 내장된 서버 측 암호 사용, KMS 마스터 키 사용 등
- 편리성
    - 스트림 즉각 생성
    - KPL(Kinesis Producer Library)를 이용해 간편하게 스트림 데이터 입력
    - KCL(Kinesis Client Library)을 이용해 실시간 데이터 처리 어플리케이션 생성
- 병렬처리
    - 다수의 Kinesis 어플리케이션으로 동일 스트림 동시간 처리
- 탄력성
    - 처리 성능 동적 조절
- 저비용
    - 초기 설치비 및 고정비 없음. 리소스 사용비만 부담
- 신뢰성
    - 7일간 스트리밍 데이터 보존

### 7.1.4.3 Kinesis Data  Firehose

- 데이터 저장소와 분석 도구에 스트리밍 데이터를 로딩하기 위한 가장 간단한 방법 제공
- 스트리밍 데이터를 수집, 변환해 Amazon S3, Redshift, Eleasticsearch, Splunk 등에 로딩
- 스트리밍 데이터를 로딩하기 위한 스토리지, 네트워킹, 환경 설정 등 모든 인프라 관리


**Amazon Kinesis Data Firehose 장점**

- 사용 편리성
    - Kinesis Data Firehose에서 손쉽게 스트리밍 데이터를 수집하고 로딩
    - Firehose가 데이터 로딩을 위한 스케일링, 샤딩, 모니터링 등 일체의 스트리밍 데이터 로딩 업무를 자동으로 처리
- AWS 데이터 저장 서비스와의 통합
    - S3, Redshift, Elasticsearch 등 AWS 저장 서비스와 통합해서 사용
- 서버리스 데이터 변환
    - 별도의 데이터 처리 파이프라인 없이, 대상 데이터 스토어가 요구하는 포맷으로 변환
- 근실시간
    - 근실시간 처리 성능 제공
    - S3, Redshift, ElasticSearch, Splunk 등으로 전송된 데이터를 60여초 이내에 로딩
- 지속적 관리 필요 없음
    - 스트리밍 데이터 로딩에 필요한 모든 업무를 자동으로 처리하는 완전 관리형 서비스
- 사용량에 따른 과금
    - 전송한 데이터 볼륨의 양에 따른 비용만 부담

### 7.1.4.4 Kinesis Data Analytics

- 실시간성의 스트리밍 데이터를 처리 및 분석하기 위한 가장 간단한 방법
- 표준 SQL 방식 사용, SQL 쿼리를 작성해 분석 결과를 로딩할 장소만 지정

**Amazon Kinesis Data Analytic의 장점**

- 강력한 실시간 처리 기능
    - 데이터 처리 시 1초미만의 처리 지연 성능을 제공
    - 스트리밍 데이터 처리를 위한 내장 함수 제공
- 완전관리형 서비스
- 자동화된 탄력성
    - 자동화된 스켕리업 다운 기능
- 사용 편의성
    - SQL 에디터, SQL 템플릿 등 상호 작용성 높은 분석 도구 제공
- 표준 SQL 지원
- 사용량에 따른 과금
    - 프로세싱 리소스에 대한 비용만 부담

**Amazon Kinesis Data Analytics의 사용 시나리오**

Kinesis Data Analytics는 로그 분석, 클릭스트림 분석, IoT 센싱 데이터 분석, 광고 기술, 게임 퍼블리싱 등 분야에서 스트리밍 데이터 처리 및 분석을 돕는다.

- 시계열 분석
    - 특정 데이터의 시간 흐름에 따른 변화를 모니터링
- 실시간 대시보드
    - 쿼리 결과의 연산을 수행하고 그 결과를 대시보드에 출력해 근실시간으로 유입 데이터를 시각화
- 실시간 경고 및 알림
    - 특정 성능 지표가 미리 정한 한곗값에 도달하면 실시간 경고 및 알림 생성

# 7.2 Amazon CloudFront

- 글로벌 CDN 서비스
- 콘텐츠 사용자와 가까운 지역(엣지 로케이션)에 네트워크망을 구축하고 지역별 엣지 캐시를 통해 사용자 경험 수준을 높여준다.
- 정적 콘텐츠는 물론, 동적 콘텐츠도 지원한다.

### Amazon CloudFront 활용 시나리오

- 정적 콘텐츠 캐싱
- 동적 콘텐츠 가속화
- DDos 공격 대응
- 강화된 보안성
- API 호출 가속화
- 소프트웨어 배포 (다운로드 속도 개선)
- 비디오 스트리밍

### Amazon CloudFront 핵심 개념

- 엣지 로케이션
    - 글로벌 데이터센터 네트워크를 통해 콘텐츠 배포
    - 엣지 로케이션은 전 세계 주요 대도시에 위치하며, AWS 리전 시설의 위치와는 다를 수 있다.
- 지역별 엣지 캐시
    - 지역별 엣지 캐시는 오리진 웹 서버와 엣지 로케이션 사이에 위치해 사용자에게 직접 콘텐츠를 전송한다.
- 배포
    - 원본 파일의 위치를 나타내는 CloudFront 경로
- 오리진
    - S3, HTTP 서버, ELB 또는 ALB, AWS 외부의 커스텀 오리진 서버를 통해 접근
    - 퍼블릭 DNS 지정
- 제어 동작
    - CloudFront의 세부적인 제어 동작

### Amazon CloudFront의 주요 제어 동작

- 경로 패턴 매칭
    - URL 경로 패턴에 따라 다양한 캐시 제어 동작 설정
- 헤더
    - 헤더 값을 통해 요청 헤더를 오리진 캐시로 포워딩
    - 헤더를 확인한 뒤 그에 맞는 동작 적용
- 쿼리 문자열 및 쿠키
    - 오리진으로 정보 전달을 위해 쿼리 문자열 사용
    - ex) [http://xxx.cloudfront.net/main.html?language](http://example.com/main.html?language)=en
- 서명 URL 및 서명 쿠키
    - 서명 URL 방식을 통해 해당 컨텐츠에 대한 비인가 접근을 막을 수 있다.
    - Set-Cookie 헤더가 사용자 계정에 전달됨. 요청에 포함된 사인 쿠키를 포워딩
    - CloudFront가 쿠키 속성을 확인해 접근 허용 또는 차단 여부 결졍
- 프로토콜 정책
    - HTTP 또는 HTTPS 중 하나만 허용
    - 모든 HTTP 요청을 HTTPS로 재전송
- 유지시간(TTL)
    - 오리진으로 요청을 전송하기 전 캐시에 특정 객체의 유지시간을 지정 가능
    - Cache-Control maxage로 객체에 기간 만료 헤더 필드 추가 가능
- gzip 압축
    - 페이징 로딩 속도 및 콘텐츠 다운로드 속도 증가, 데이터 전송 비용을 줄일 수 있음

### CloudFront 배포 방식

- 웹 배포
    - html, css, php 등 정적 및 동적 콘텐츠 배포에 유리
- RTMP 배포
    - 스트리밍 미디어 파일 배포에 유리

### 지역 제한 기능

- 특정 국가의 콘텐츠 요청을 거부/허용 가능

### 오류 처리 기능

- HTTP 4xx 또는 5xx 상태 코드를 반환하면 커스텀 오류 페이지를 제공 가능

# 7.3 Route 53

- 관리형 DNS 서비스
- 고가용성, 고확장성 서비스로 100%의 SLA를 보장하는 유일한 서비스
- 다수의 리전과 AWS VPC 간의 DNS 주소 변환도 가능
- 다양한 DNS 기록 타입 제공
- 애플리케이션, 웹 서버 등 리소스에 대한 성능을 모니터링하는 헬스 체크 기능 제공
- Traffic Flow를 이용해 사용자에게 접속 지연, 지리적 위치, 엔드포인트 상태 등을 고려한 최고의 연결성 제공 가능

### 라우팅 정책

- 가중치 라운드 로빈 (Weighted Round Robin)
- 지연 기반 라우팅 (Latency-Based Routing)
- 장애 대응 라우팅(Failover Routing)
- 지역 DNS 라우팅 (Geo DNS Routing)

# 7.4 AWS WAF

AWS WAF는 커스터마이징 가능한 보안 규칙 정의를 통해 웹 어플리케이션에 대한 접근을 허용 또는 거부할 수 있다.

- 침해 시도로부터 보호
    - SQL 인젝션 공격, 크로스 사이트 스크립팅(XSS) 공격 등 주요 침해 시도로부터 리소스를 보호한다.
- 악성 요청 대응
    - 웹 크롤러를 이용한 공격 등 대응
- DDos 공격 방어

### 7.4.1 WAF 보안 조건

- 크로스 사이트 스크립팅 조건을 이용하면 악의적 스크립트를 포함한 것으로 보이는 요청을 허용 또는 차단할 수 있다.
- IP 일치 조건을 이용하면 발신지 IP 주소에 따라 요청을 허용 또는 차단할 수 있다.
- 지역 일치 조건을 이용하면 발신 국가별로 요청을 허용 또는 차단할 수 있다.
- 전송 용량 제한 조건을 이용하면 제한 용량을 초과하는 요청을 허용 또는 차단할 수 있다.
- SQL 인젝션 일치 조건을 이용하면 악성 SQL 코드 포함 여부에 따라 요청을 허용 또는 차단할 수 있다.
- 문자열 일치 조건을 이용하면 요청에 포함된 문자열의 내용에 따라 요청을 허용 또는 차단할 수 있다.
- 정규 표현식 일치 조건을 이용하면 정규 표현식 내용에 따라 요청을 허용 또는 차단할 수 있다.

### 7.4.2 WAF 보안 규칙

- 일반 규칙
    - 특정 요청을 목표로 하는 조건만 사용
    - ex) 특정 SQL 코드를 포함하면 차단한다.
- 비율 규칙
    - 5분 간격으로 비율 제한을 적용
    - ex) 5분 동안 특정 IP 주소에서 들어오는 요청이 2000회를 넘어가면 차단한다.

### 7.4.3 WAF 설정 방법

1. 웹 ACL 설정
2. 롤 및 롤 그룹 추가
3. 규칙 우선순위 설정
4. 보안 규칙 검토
5. 보안 규칙 확인 및 적용

# 7.5 AWS Shield

AWS에서 실행되는 애플리케이션에 대한 분산 DDos 공격을 방어하기 위한 관리형 서비스

### 7.5.1 AWS Shield의 장점

### AWS Shield Standard

- 모든 AWS 고객에게 자동 적용되며 별도 비용은 없다.
- 네트워크 및 전송 레이어에 대한 DDos 공격으로부터 AWS 고객을 보호한다.
- 모든 AWS 리전에서 무료로 사용

### AWS Shield Advanced

- 유료 서비스로 Standard 기능 외에 다양한 추가기능을 제공한다.
- AWS Global DDos 대응 팀에 DDos 지원 요청 가능
- DDos 공격에 대한 상세한 시각화 기능 제공 등

# 7.6 AWS SQS

### 7.6.1 메시지 큐란?

- 메시지 큐를 통해 분산 아키텍처를 구현하기 위한 기능이다.
- 메시지 큐는 서버리스 및 마이크로서비스 아키텍처에서 서버와 서버 간 비동기적인 소통을 위한 양식
- 메시지는 처리 및 삭제되기 전까지 큐에 저장 상태를 유지
- 메시지 큐는 대규모 프로세싱 잡을 좀 더 작게 분할해 개별 요소가 서로 독립적으로 작동할 수 있도록 하며, 배치 잡의 실행 속도를 높이고 워크로드 처리 성능을 높일 수 있음
- 클라우드 아키텍처 설계 시 애플리케이션을 분할해서 작은 블록으로 구현하는 방식 권장 → 코드가 간소해지고 성능, 신뢰성, 확장성이 높아짐

> CAP 이론: 분산 시스템에서 일관성, 가용성, 파티션 실패 대응성 등 세 가지 요소 중 두 가지 이상을 한 번에 달성하는 것은 불가능하다는 이론


### 7.6.2 Amazon SQS 주요 기능

Amazon SQS 신속성, 신뢰성, 확장성을 지닌 완전 관리형 큐 서비스

- Amazon SQS를 이용해 각 리전에서 다중 AZ를 중복 구현할 수 있으며, 특정 AZ에 문제가 발생해도 서비스는 정상 작동한다.
- 다수의 복제 메시지를 다중 AZ 환경에 저장할 수 있으며, 메시지는 최대 14일간 유지된다.
- 메시지 프로듀서 또는 컨슈머 어플리케이션이 실패하더라도 메시지는 소실되지 않는다.
- 분산 아키텍처 환경 기반으로 SQS는 별도 프로비저닝 없이 확장한다. 트래픽이 많아지면 자동으로 스케일업하고, 트래픽이 감소하면 자동 스케일다운 한다.
- 메시지는 최대  256KB의 XML, JSON, 포맷없는 텍스트 데이터를 담을 수 있다.

### 7.6.3 SQS 큐 타입

- 스탠다드 큐
    - SQS의 기본 큐 타입으로 초당 거의 무제한의 트랜잭션 지원
    - 최소 1회 메시지 전송 보장, 전송 순서대로 도착하는 것을 보장하는 전송 순서 보장 기능 제공
    - 메시지 순서를 저장하지만 가끔 순서와 다른 메시지가 전송되기도 한다.
- FIFO 큐
    - 먼저 들어온 것이 먼저 나가는 FIFO 원칙 적용
    - 메시지를 여러 번 전송해도 순서가 바뀌지 않는다.
    - 처리 성능은 초당 300회의 트랜잭션으로 제한되고, 메시지는 초당 최대 3000개까지 지원한다.

### 7.6.4 SQS 동작 순서

1. 메시지 프로듀서가 큐에 메시지를 보낸다.
2. SQS 서버는 중복 구현 원칙에 따라 해당 메시지를 다수의 AZ에 분산한다.
3. 메시지 컨슈머가 이를 처리할 준비가 되면, 큐에서 메시지를 꺼낸 뒤 처리한다.
4. 메시지가 처리되면 0초~12시간에 이르든 가시성 타임아웃 기간동안 큐에 유지되고 가시성 타임아웃이 만료되면 메시지를 삭제한다.

> 가시성 타임아웃: 메시지를 큐에서 꺼내 확인하는 시간. 다른 컴포넌트에게는 보이지 않는다.
> 

### 7.6.5 SQS 환경 설정

- 메시지 보유 기간: 수신가자 메시지를 삭제하기 전까지 Amazon SQS가 메시지를 보유하는 기간으로 최소 1분, 최대 14일까지 가능하다.
- 최대 메시지 크기: SQS가 수신할 수 있는 메시지의 최대 크기로 최소 1KB, 최대 256KB까지 가능하다.
- 전송 지연 시간: 큐에 포함된 모든 메시지의 전송 지연 또는 연기 시간 (0초~15분)
- 수신 메시지 대기 시간
    - 이 파라미터를 이용하면 숏 폴링과 롱 폴링 옵션을 쓸 수 있다.
    - 숏 폴링: 큐에 메시지가 없는 경우에도 메세지를 즉시 반환하며, 대기시간을 0초로 설정하면 숏폴링 이 활성화된다.
    - 롱 폴링: 큐에 메시지가 없는 경우 빈 메시지를 응답한다. 수신 메시지 대기 시간을 1초~20초로 설정하면 롱 폴링이 활성화된다.
- 콘텐츠 기반 복제
    - FIFO 큐에서만 사용할 수 있고, 콘텐츠 기반 복제 ID를 생성하기 위해 메시지 바디의 SHA-256 해시를 사용한다.
- 데드레터 큐
    - 오류로 인해 메시지가 처리되지 못한 메시지만 모아 볼 수 있음
- 최대 수신 파라미터
    - 성공적으로 처리되지 못한 메시지를 데드레터 큐로 전송하기 전 메시지의 최대 수신 횟수
- SSE(Server Side Encryption)
    - 암호화된 큐에 메시지를 전송 가능

# 7.7 AWS SNS

- 클라우드 기반 노티피케이션 서비스
- 토픽의 메시지를 배포하는 즉시 이 토픽에 구독 신청을 한 서비스가 해당 메시지를 받아볼 수 있다.


### 7.7.1 Amazon SNS 주요 기능

- 메시지는 다중 AZ 환경에 저장되어 신뢰할 수 있다.
- HTTP/HTTPS, e-mail, SMS, Lambda, SQS 등 다양한 전송 프로토콜을 지원하므로 메시지 전송 유연성이 높다.
- 메시지는 즉각 또는 지연시켜서 전달할 수 있다.
- 푸시 기반 전송을 통해 구독자에게 자동으로 메시지를 전송할 수 있다.
- SNS와 CloudWatch를 통합한 모니터링 기능을 통해 모든 토픽에 대한 성능 지표를 수집, 시각화, 분석할 수 있다.
- 관리콘솔, CLI, SDK, SNS Query API, Window Power Shell을 이용해 접속할 수 있다.
- SNS 메시지는 텍스트는 최대 256KB, SMS는 140bytes의 데이터를 담을 수 있다.

### 7.7.2 SNS 이용 방법 3단계

- 토픽 생성
- 토픽 구독
- 토픽 배포

# 7.8 Step Functions과 Amazon Simple Workflow(SWF)

- AWS Step Function
    - 시각화된 워크플로우를 통해 분산 어플리케이션 및 마이크로서비스 컴포넌트의 관리를 돕는 완전 관리형 서비스
    (기존의 Amazon Simple Workflow를 대체)

사용자는 AWS Step Functions를 이용해 애플리케이션을 상태 저장 및 관리를 위한 스테이트 머신으로 정의하고, 앱의 동작을 한데 모아 일련의 스텝으로 관리할 수 있도록 돕는다.

### 7.8.1 AWS Step Functions의 8가지 상태 타입

- 임무(Task)
- 선택(Choice)
- 병렬(Parallel)
- 대기(Wait)
- 실패(Fail)
- 성공(Succeed)
- 전달(Pass)
- 맵(Map)

# 7.9 Elastic Beanstalk

AWS에 애플리케이션을 쉽고 간편하게 배포, 모니터링, 확장할 수 있다.

사용자가 코드만 업로드하면 EC2, ECS, AutoScaling, ELB 등 AWS 리소스에 대한 프로비전 업무를 대신 처리한다.

- 실행 환경
    - EC2, RDS, ELB, AutoScaling 등. 하나의 애플리케이션을 위해 다수의 실행 환경을 생성할 수 있다. (개발 환경, 테스트 환경, 상용 환경 등)
- 애플리케이션 버전
    - S3에 저장된 애플리케이션 실행 코드로 다양한 버전을 포함할 수 있고 각 버전은 별도로 저장된다.
- 저장 환경 설정
    - 환경 설정 및 리소스 동작을 정의.

AWS Elastic Beanstalk는 서로 다른 유형의 웹 애플리케이션을 지원하기 위해 웹 서버와 워커라는 두 가지 실행 환경 티어를 제공한다.

단일 인스턴스, 또는 데이터베이스가 포함된 다수의 인스턴스에 배포될 수 있다.

사용자의 애플리케이션에 대한 헬스 체크를 통해 일체화된 모니터링 및 관리 인터페이스를 제공

- AWS Elastic Beanstlk이 지원하는언어 및 개발 스택
    - 아파치 톰캣: java 용
    - 아파치 HTTP 서버: PHP, Python, Node.js 용
    - Passenger, Puma: Ruby 용
    - Java SE, Docker, Go 등

# 7.10 AWS OpsWorks

AWS OpsWorks는 모든 유형과 규모의 애플리케이션 배포 및 운영을 돕는 환경 설정 관리 서비스로 애플리케이션의 신속한 환경 설정, 배포, 업데이트를 지원하고, 자동화된 스케일링 및 헬스 모니터링 도구를 제공한다.

OpsWorks가 제공하는 관리형 인스턴스인 Chef와 Puppet은 서버의 환경 설정 업무를 자동화하는 코드를 사용할 수 있는 자동화 플랫폼

1. Chef Automate
    
    완전 관리형 Chef 서버이자 지속적 배포와 준수 규정 및 보안 사항에 대한 테스트를 위한 종합적인 자동화 도구
    
2. Puppet Enterprise
    
    관리형 Puppet Enterprise 서버이자, 오케스트레이션, 자동화 프로비저닝, 추적 데이터 시각화 등 종합적인 워크플로우 자동화도구
    
3. OpsWorks stacks
AWS와 온프레미스 환경의 애플리케이션 및 서버 관리를 돕는다.

OpsWorks를 이용할 경우 애플리케이션 실행을 위한 설치 및 환경 설정 내역을 담은 레이어를 통해 모든 인스턴스의 환경 설정 작업을 자동으로 처리할 수 있다.

# 7.11 Amazon Cognito

 Amazon Cognito는 다수의 모바일 디바이스에서 사용자를 좀 더 편리하게 관리할 수 있도록 도와주는 사용자 신원 증명 및 데이터 동기화 서비스이다.

개발자는 퍼블릭 로그인(Google, Facebook 등), 기업용 로그인(SAML 기법을 사용하는 Active Directory 등)을 통해 사용자의 신원을 효과적으로 관리할 수 있다.

Amazon Cognito User Pools는 표준 기반 신원 증명 제공자로서 Oauth 2.0, SAML 2.0, OpenID Connect 등 IAM 표준을 지원한다.

# 7.12 Amazon Elastic MapReduce

Hadoop 프레임워크는 분산 컴퓨팅 환경을 통해 막대한 양의 데이터를 처리할 수 있지만 복잡하다.

Amazon EMR(Elastic MapReduce)는 다수의 EC2 인스턴스를 분산 컴퓨팅 환경으로 구성한 관리형 Hadoop 프레임워크 서비스를 제공한다.

EMR을 사용하려면 먼저 S3에 데이터를 업로드하고 EMR 클러스터를 론칭한다. 클러스터가 론칭되면 즉시 데이터를 분석할 수 있으며, 이를 위한 설정, 실행, 튜닝 작업은 걱정할 필요가 없다.

EMR 클러스터 노드

- 마스터 노드
    - 코어 노드와 테스트 노드의 잡 배분을 조율
- 코어 노드
    - 마스터 노드가 할당한 테스크를 실행
- 테스크 노드
    - 테스크를 실행만 하고 저장하지 않음. (순수 연산)

# 7.13 AWS CloudFormation

CloudFormation은 작성한 인프라 아키텍처 모델(템플릿)에 따라 AWS 리소스 스택의 프로비전 및 관리를 돕는다.

CloudFormation을 사용할 때는 먼저 템플릿을 생성한다. 템플릿은 JSON 포맷의 파일로 인프라와 애플리케이션 스택을 구성하는 AWS 리소스의 환경 설정을 위한 설계도라 할 수 있다.

버전 컨트롤에서 템플릿을 확인할 수 있으므로 인프라 및 애플리케이션 스택의 모든 변경 사항을 추적할 수 있다.

마치 인프라를 코드처럼 다룰 수 있다.

사용자는 템플릿을 이용해서 AWS 리소스와 프로퍼티를 정의할 수 있고, 스택 생성 시 CloudFormation은 템플릿별로 리소스를 프로비저닝한다.

# 7.14 AWS 모니터링 서비스

## 7.14.1 AWS CloudWatch

- AWS 클라우드에 배포된 모든 리소스를 모니터링하기 위한 서비스
- 헬스 체크, 활성화 수준 검토, 성능 확인 등 주요 지표를 모니터링
- AWS 클라우드 리소스는 물론, 클라우드 기반 애플리케이션을 모니터링해 주요 성능 지표를 시각화 및 분석

### CloudWatch 주요 기능

1. 성능 지표 수집 및 추적
    1. EC2, RDS, ELBs, EBS 볼륨, DynamoDB 등에 대한 성능 지표를 추적 가능
    2. 기본 설정 성능 지표 외에도 사용자가 정의한 커스텀 성능 지표를 추가
    3. 지표 수집 간격에 따라 보존 기간이 다르다.
2. CloudWatch Events를 이용한 실시간 모니터링
    1. AWS 리소스에 생긴 사소한 변화도 모두 감지
    2. CloudWatch Events 가 변화를 감지하면 근 실시간으로 지정된 타깃에 알림을 전송(이때의 타깃은 Lambda 함수, SNS 큐, SNS 토핏, Kinesis Stream 등을 지정할 수 있다.)
3. 모니터링 및 Logs 저장
    1. CloudWatch Logs는 기존 시스템, 애플리케이션, 커스텀 로그 파일을 이용해 사용자의 시스템, 애플리케이션을 모니터링하거나 문제점을 해소할 수 있도록 돕는다.
    2. 다양한 로그 원천으로부터 로그 데이터를 수집한 뒤 중앙화된 로그 관리를 할 수 있다.
4. 알람 설정
    1. CloudWatch 알람을 생성해 알람 상태 변경 시 Amazon SNS 메시지를 전송하도록 할 수 있다.
    2. 알람으로 설정 가능한 상태: OK, ALARM, INSUFFICIENT_DATA
5. 그래프와 통계정보 시각화
    1. 대시보드는 선택한 성능 지표에 대한 싱글 뷰 모드로 제공되며 다수의 리전에 분포한 리소스, 애플리케이션의 헬스 수준을 판단할 수 있다.
    2. CloudWatch 대시보드는 운영 팀을 위한 업무 지침에도 활용할 수 있다.

## 7.14.2 AWS CloudTrail

CloudTrail은 콘솔, CLI 등 도구를 통해 전달된 모든 API 호출 로그를 관리하는 서비스로 해당 API에 대해 누가, 언제, 어디서, 어느 작업을 했는지 로그 데이터로 저장한다.

관리자는 CloudTrail을 이용해 AWS 리소스의 변경 추적, 규정 준수 여부 파악, 운영상의 문제 발견 등 다양한 업무를 처리할 수 있다.

CloudTrail 이벤트 히스토리는 해당 리전에서 90일간 보존된다.

## 7.14.3 AWS Config

AWS Config는 사용자 계정에 포함된 AWS 리소스와 현재의 환경 설정에 대한 세부적인 목록을 제공하는 완전 관리형 서비스이다.

EC2 인스턴스 론칭, 시큐리티 그룹의 ingress, egress 규칙, VPC를 위한 네트워크 ACL 등 리소스의 환경설정 상의 변화를 지속적으로 기록한다.

- AWS Config를 이용해 할 수 있는 작업
    - 지속적 모니터링
    - 지속적 평가
    - 변화 관리
    - 운영상의 문제 해결
    - 규정 준수 모니터링

## 7.14.4 VPC Flow Logs

Amazon VPC Flow Logs는 VPC 네트워크 인터페이스의 IP 트래픽 정보를 수집한 뒤 Cloud Watch Logs를 이용해 로그 데이터를 저장하며, ES 도는 Kibana 등의 서비스와 통합해 로그 데이터를 시각화하거나 인스턴스에 특정 트래픽을 도달하지 못하는 문제를 해결할 수 있다.

Flow Logs는 시큐리티 그룹과 네트워크 ACL 규칙에 따라 승인된 트래픽은 물론 거부된 트래픽 정보도 모두 수집한다.

## 7.14.5 AWS Trusted Advisor

AWS Trusted Advisor의 다섯 가지 주요 기능

- 비용 최적화
- 보안성
- 장애 대응성
- 성능
- 서비스 용량 제한 관리

대시보드로 위 항목에 대한 정보를 한눈에 볼 수 있음.

서비스 용량 제한, S3 버킷 접근, 시큐리티 그룹, IAM 현황, 루트 계정에 대한 MFA 현황, EBS 퍼블릭 스냅샷, RDS 퍼블릭 스냅샷 등 7가지 정보를 제공한다.

# 7.15 AWS Organization

AWS Organization은 계정 관리 업무를 일원화, 간소화하며, 다수의 AWS 계정에 정책 기반 관리 기법을 적용할 수 있다.

AWS Organization 의 서비스를 통햏 통제 정책, SCP를 이용해 좆기 내 다수의 계정에서 AWS 서비스 이용을 중앙화된 방식으로 통제할 수 있다.