# 5. AWS IAM - 신분 및 권한 관리

# 1. IAM의 개요 소개

## 1.2 IAM이란?  
`AWS 신분 및 접속 관리 서비스`

- 사용자와 사용자 그룹이 보안이 유지된 상태에서 AWS 리소스에 접근 가능
- IAM을 통해 특정 사용자(유저)에게 특정 서비스에 대한 (읽기만 가능한) 관리자 권한을 부여할 수 있음
- 리소스에 접근하기 위한 어떤 권한이 있는지를 설명하기 위한 체계
- IAM을 이용해서 업무 감사, 사용자 로그 분석, 지속적 모니터링, 계정 별 활동 리뷰 가능

## 1.2 신분 인증

- 유저 및 접근 권한 관리
    - 클라우드 유저를 생성하고 엑세스 키, 패스워드, 멀티 팩터 인증 등 보안 수단 관리 가능
    - 유저의 접근 허용 관리, 유저가 수행할 수 있는 작업의 세부적인 통제 가능
- 그룹화된 유저 및 접근 관리
    - 협업을 위해 그룹화된 유저 관리 가능
    - AWS 리소스에 접근할 수 있는 SSO 방식으로 기업 디렉토리에 접근 가능

## 1.3 권한 부여

- 사용자에게 필요한 권한 부여
- ‘최소한의 권한 부여 및 책임 분리’
- IAM 정책은 JSON으로 작성된 하나 또는 그 이상의 접근 승인 규칙을 담고 있음

## 1.4 감사

- 클라우드 업무 감사(Auditing)을 위한 도구를 제공
- 감사 업무: 기업이 제정한 규칙과 국가 등이 정한 법규 등의 준수 여부를 확인하고 증빙하는 작업
- CloudTrail
    - 게정에서 일어나고 있는 일을 기록하고 이에 대한 로그 파일을 S3 버킷에 저장
    - 주요 행동
        - 작업을 요청한 유저
        - 작업이 요청된 시간
        - 작업의 내용
        - 작업으로 제공된 리소스
        - 요청 발송 장소와 도달 장소

# 2. IAM의 보안 자격 정보 유형

## 2.1 자주 사용하는 보안 자격 증명

- IAM 유저네임과 패스워드: AWS Management Console 로그인 시 사용
- Email 주소와 패스워드: 루트 계정과 연동
- 엑세스 키: CLI, API, SDK 활용 시 사용
- 키 페어: EC2 로그인 시 사용
- 멀티 팩터 인증: 루트 계정 로그인 시 추가 보안 인증 수단

## 2.2 임시 보안 자격 정보

- 단기간만 사용할 목적으로 활용되고, 수 분에서 수 시간만 보안 자격으로서의 유효성이 유지됨
- 파트너 개발자 등 신뢰할 수 있는 다른 유저에게 AWS 리소스에 대한 접근 권한을 부여하기 위해 임시 보안 자격 정보를 제공하는 경우 AWS 시큐리티 토큰 서비스 사용
    - 이 토큰은 유저 측에서 저장되지 않으며, 유저가 요청할 때마다 동적으로 생성됨

# 3. IAM의 유저, 그룹, 롤

## 3.1 유저

- IAM에서 유저란 AWS 생태계에 존재하는 사용자 또는 서비스를 가리키는 유일무이한 개체
- AWS는 본인을 비롯해 다수의 관리자급 사용자를 위해서 우선 몇 개의 유저 개체를 생성하고 이들에게 어드민 권한을 부여하는 방법을 권장
- 특정 개발자가 데이터베이스 작업을 해야 하는 경우, 어드민은 RDS에 대한 리드 온리 권한만 부여 가능

### IAM을 통한 유저 생성 방법

1. IAM에서 유저 생성
2. 유저에 보안 자격 증명 부여
3. 유저에 접근 승인, 역할(롤), 책임 부여
4. 유저를 하나 혹은 다수의 그룹에 추가

### 루트계정 및 유저 보안

- 루트계정: 리소스에 대한 무제한 접근 권한
- 처음 루트 계정으로 로그인한 뒤 IAM 유저를 생성하고 풀 엑세스 어드민 권한을 부여해 사용하고, 루트 계정으로는 로그인하지 않을 것을 권장
- 담당 업무 수준에 맞춘 새로운 어드민 권한의 유저 개체를 생성해서 제공
- 프로그래밍 기법으로 리소스에 대한 요청을 관리하려는 경우 유저에게 개인별 엑세스 키를 제공

## 3.2 그룹

동일한 권한을 가진 유저들을 그룹으로 만들어 그룹에 새로운 유저를 추가하기만 한다면 해당 권한을 모두 부여하는 방식으로, 업무를 단순화할 수 있음

### IAM 그룹의 특징

- 그룹은 다수의 역할과 권한으로 구성되고 IAM을 이용해 승인
- 그룹에 추가된 유저는 그룹에 정의된 역할과 권한을 상속
- 그룹에 다수의 유저 추가 가능
- 하나의 유저가 다수의 그룹에 포함될 수 있음
- 단, 하나의 그룹을 다른 그룹에 추가할 수 없고 그룹에는 오직 유저만 추가 가능
- AWS 계정의 모든 유저를 포함한 기본 그룹이 자동으로 생성되지는 않으며, 그룹을 생성해서 모든 유저 추가 가능

## 3.3 롤

- AWS 환경에서 영구적인 신분을 보유한 IAM 유저
- 영구적인 신분을 보유하지 않는 IAM 그룹
    - 역할(롤)을 생성해 승인권을 관리
- IAM 롤을 통해 유저 또는 서비스가 필요로하는 리소스에 (유저 또는 그룹에 승인권을 직접 제공하지 않고) 일련의 접근 승인 규칙을 추가 가능
- 유저가 롤을 할당받았을 때 또는 애플리케이션에 롤이 적용될 때 AWS에 의해 동적으로 생성돼 해당 유저 또는 애플리케이션에 제공

### IAM 롤의 주요 활용 방식

- AWS 리소스에 접근하지 않는 유저, 애플리케이션, 서비스의 접근 대행
- 앱 내부에 AWS 키를 임베드 하길 원치 않는 경우
- (기업용 디렉터리 등을 통해) AWS 외부에서 이미 본인의 신분을 확인시켜준 사용자에게 AWS 접근 권한을 부여하려는 경우
- (외부 감사인 등) 제 3자에게 계정에 대한 접근권한을 부여하려는 경우
- 특정 어플리케이션이 이미 다른 AWS 서비스를 사용할 수 있는 경우
- 특정 임무만을 수행하기 위해 임시 보안 승인 정보를 요청하는 경우

### 롤 생성을 위한 두 가지 정책

- 누가 롤, 즉 역할을 맡을 것인가 (역할의 주체, 담당자)
- 접근 승인 정책 또는 접근 권한 정책
    - 어떤 역할을 맡은 사용자에게 어떤 리소스 또는 액션을 접근하게 할 것인지 정의

### IAM 권한의 계층 (Hierarchy of Privileges)

가장 권한이 높은 유저를 맨 앞에 놓고 가장 권한이 낮은 유저를 맨 뒤에 놓는다

- AWS 루트 유저 또는 계정 소유자: 모든 서비스와 리소스에 대한 무제한의 접근 권한 보유
- AWS IAM 유저: 제한된 권한 보유. 그룹과 유저 정책에 의해 제한 받음
- 임시 보안 자격 정보 보유자: 신부 확인 후 접근이 제한되고, 토큰 생성에 대한 정책으로 추가 제한됨

# 4. IAM 활용 베스트 프랙티스

## 4.1 IAM 유저 활용

- AWS 계정 생성 직후, 소유자이자 관리자를 위해 IAM 유저를 생성해 어드민 권한을 부여하고 루트 유저 계정은 안전하게 감춘다.
- AWS에서 루트 유저는 프로그래밍 기법의 호출 또는 요청을 위해 절대 사용하지 않아야 한다.
- AWS 계정에 대한 접근이 필요한 다른 사용자가 있다면 IAM 유저를 생성해 제공한다.

## 4.2 강력한 패스워드 정책 수립

- 강력한 패스워드 정책을 수립하고 90일이 경과한 패스워드는 폐기한다.
- 패스워드에는 최소 하나의 대문자, 소문자, 기호문자, 숫자가 포함되게 하고, 최소 8자에서 10자 이상이 되도록 한다.

## 4.3 정기적으로 보안 자격 정보 갱신

- Access Key Last Used 기능을 이용해 90일 이상 사용되지 않은 보안 자격 정보를 찾고, 비활성화시키고, IAM 유저의 보안 자격은 순회 갱신한다.
- Credential Report를 통해 보안 자격 순회 상황을 모니터링한다.

## 4.4 MFA 활용

- 슈퍼 유저 권한의 계정에 MFA, 즉 멀티 팩터 인증을 적용해 보안 레이더를 추가하여 좀 더 안전하게 계정을 보호할 수 있다.

## 4.5 그룹으로 승인 관리

- 개별 유저마다 승인 권한을 할당하는 대신 연관 업무 별로 그룹을 생성해 정책 규정을 할당한다.
- 직원수가 늘어나도 권한 관리의 복잡성이 커지지 않으며, 우연히 과잉 권한을 주게 될 가능성도 줄어든다.
- 담당 업무의 책임 수준에 따라 권한을 부여하고 다수의 유저에 관한 업데이트에도 유리하다.

## 4.6 최소한의 권한 부여

- 유저 관리에 있어 최소한의 권한 부여 규칙을 준수해야 한다.
- 항상 최소한의 권한을 제공하고 필요 시마다 승인을 추가해야 한다. 이렇게 하면 권한 남용을 막을 수 있고, 묶어 있던 권한을 풀어주는 편이 그 반대의 경우보다 좋으므로 항상 필요 시마다 권한을 추가한다.

## 4.7 IAM 롤 활용

- 서로 다른 계정 간의 접근 권한 부여 시, 계정 내에서의 접근 권한 부여 시, 그룹 유저에게 접근 부여 시 항상 IAM 롤을 사용한다.
- 롤을 이용하면 보안 자격 정보를 공유하거나 장기 보안 정보를 저장할 필요가 없고, 누가 어떤 리소스에 접근할 수 있는지 명확하게 파악할 수 있다.

## 4.8 Amazon EC2 인스턴스를 위한 IAM 롤 활용

- Amazon EC2 인스턴스에서 실행되는 어플리케이션이 있고, 이 어플리케이션이 다른 AWS 서비스에 접근해야 하는 경우 애플리케이션 보안 자격 정보를 제공해야 한다.
- EC2 인스턴스에서 실행되는 애플리케이션에 보안 자격을 부여하려 할 때 IAM 롤을 활용한다.

## 4.9 보안 강화를 위한 IAM 정책 조건 수립

- IAM 정책으로 특정 리소스에 대한 접근을 통제할 수 있는데, 정책 조건을 이용하면 접근 권한에 대한 보다 세부적인 규칙을 추가할 수 있다.
- 예를 들어, 정책 조건을 사용하면 특정 IP 주소로부터 지정한 리소스에 특정 날짜, 특정 시간에만 접근하게 할 수 있다.

## 4.10 AWS CloudTrail 활용

- AWS 생태계의 감사 중요성은 매우 크므로 모든 리전에 AWS CloudTrail의 로그 파일 검증 기능을 활성화시키는 것이 좋다.
- 또한 Amazon S3 버킷에 저장된 CloudTrail 로그 데이터를 안전하게 관리하는 일 또한 중요하다.

# 5. AWS 플랫폼 보안 규정

## AWS 보안 규정 프로그램

- 고객으로 하여금 AWS 클라우드 내에서 보안 유지 및 데이터 보호가 어떻게 이뤄지는지 잘 이해할 수 있도록 해준다.
- AWS는 다양한 보안 기법과 IT 보안 표준을 제공한다.
- 또한 AWS는 산업 표준안에 부합하는 보안 솔루션을 배포할 수 있도록 돕는다.

# 6. 보안에 대한 공유 책임 모델

## 6.1 AWS 공유 책임 모델(Shared Responsibility Model)

- 클라우드 내에서 보안이 온프레미스 데이터 센터내에서의 보안과 어떻게 다른지 알아본다.
- AWS는 클라우드 환경을 구성하는 인프라에 대한 보안을 책임지고, 기업은 클라우드에 저장한 것 또는 클라우드에 연결한 것에 대한 보안을 책임지게 된다.

## 6.2 보안에 대한 AWS의 책임

- 데이터 센터에 대한 물리적 보안
- Amazon EC2 보안
- 네트워크 보안
- 환경 설정 관리
- 고가용성 데이터 센터
- 디스크 관리
- 스토리지 디바이스 폐기

## 6.3 보안에 대한 고객 측의 책임

- 운영체제
- 애플리케이션
- 방화벽
- 네트워크 환경 설정
- 서비스 환경 설정
- 자격 인증 및 계정 관리

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fc2e4d2d-6c2a-4b1e-81e1-0ef41ff130b4/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/32bc45a3-15e6-4e63-a56a-dffabad27f9f/Untitled.png)

## 6.4 AWS 보안 제품 및 서비스

### 6.4.1 Resource Access Manager

- AWS 리소스를 다른 계정 또는 AWS Organizations를 통해 연결된 계정과 공유

### 6.4.2 AWS Secrets Manager

- 사용자에 의한 기업 비밀 관리, 인출, 데이터베이스 접근 권한 및 API 키의 순회 번경, 기업 비밀의 생애주기 관리 등 업무를 지원

### 6.4.3 Amazon GuardDuty

- 지능형 보안 위협 감지 서비스로 AWS 계정과 이에 연동된 애플리케이션 및 서비스를 모니터링하고 보안 위협으로부터 대처

Gauard Duty의 보안 감지 유형

- 공격자의 정찰 행위: 실패한 로그인 요청, IP 포트 개방, VPC 포트 스캐닝, 특이한 API 활동 등, 공격자에 의한 정찰 행위 등이 포함
- 인스턴스에 대한 위협: DDos 공격, 비트코인 채굴, 접속 거부 행위, 비성상적인 네트워크 트래픽 등 포함
- 계정에 대한 위협: 프록시 서버에 대한 미확인 지역에서의 로그인 요청, 지역에서의 비정상적인 API 호출

### 6.4.4 Amazon Inspector

- EC2 인스턴스의 잠재적인 보안 및 환경 설정 문제를 진단하는 서비스
- 버전, 패치 레벨, 환경 설정 내역, 운영체제 및 애플리케이션의 작동 환경과 관련된 수천 가지의 침해 시도 및 보안 위협 노출 시도를 확인한다.

### 6.4.5 Amazon Macie

- Amazon S3에 저장된 데이터를 보호하며, S3에 저장된 데이터의 종류, 사업적 가치, 해당 데이터에 대한 접근과 관련된 행동에 따라 데이터를 분류한다.

### 6.4.6 AWS Certificate Manager

- AWS 서비스 사용을 위한 Secure Sockets Layer(SSL) 인증서를 관리하며 이를 통해 SSL/Transport Layer Security (TLS_ 인증서를 프로비전, 관리, 배포할 수 있다.

### 6.4.7 AWS Web Application Firewall(WAF)

- WAF는 웹 어플리케이션에 대한 악성 트래픽을 감지할 수 있는 방화벽이며, 사용자는 이를 통해 SQL 인젝션 또는 스크립팅과 같은 전형적인 웹 트래픽 공격을 방어할 수 있는 다양한 규칙을 생성할 수 있다.

### 6.4.8 AWS Shield

- DDos 공격에 대응하기 위한 관리형 서비스

### 6.4.9 AWS CloudHSM

- 전용 하드웨어 보안 모듈 (dedicated hardware security module - HSM)을 통해 고객과의 계약 준수를 위해 요구되거나 법규 준수에 필요한 보안 수준을 제공한다.
- HSM은 보안 키 스토리지 및 암호화 연산 기능을 제공하는 변조 저항성 하드웨어로 클라우드 내의 키를 안전하게 생성하고 관리한다.

### 6.4.10 AWS KMS

- AWS Key Management Service(KMS)는 암호화 작업 키 생성 및 제어를 위한 관리형 서비스로 단일 제어 지점에서 다수의 AWS 통합 서비스 및 애플리케이션을 이용하기 위한 키를 관리하고 일관된 정책을 유지할 수 있다. KMS는 키 보호를 위해 하드웨어 보안 모듈을 사용한다.

## 인스턴스를 위한 IAM 롤의 특징

- AWS의 다른 서비스에 대한 서명 요청을 위한 AWS 액세스 키는 인스턴스 실행 시 자동으로 활성화된다.
- 인스턴스용 AWS 엑세스 키는 하루에도 수 차례 자동으로 순회 및 변경되며, 새로운 엑세스 키는 기존 엑세스 키의 만료 최소 5분 전에 활성화된다.
- 인스턴스에서 실행되는 애플리케이션에 매우 세분화된 서비스 승인 권한을 할당할 수 있고, 이를 통해 AWS의 다른 서비스에 요청을 보낼 수 있다.
- 온디맨드, 스팟, 예약 인스턴스 등 어떤 인스턴스 타입에서도 론칭 시 IAM 롤을 추가할 수 있다.
- 윈도우 AMI 및 리눅스 AMI에서도 IAM 롤을 사용할 수 있다.