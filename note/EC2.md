# AWS 공인 솔루션스 아키텍트 올인원 어소시에이트

## 4장. Amazon EC2 인스턴스

> Amazon EC2의 장점
1. 빠른 제품 출시 

2. 확장성
- 워크로드에 따라 언제든 스케일업 또는 스케일다운이 가능하다.
- 성능은 최대화 / 비용은 최소화
3. 통제성
- 웹 서비스 API를 이용해 서버를 원격으로 제어 및 재부팅할 수 있고, 아마존 콘솔을 통한 접근도 가능하다.

4. 신뢰성

- 기존 서버에 문제가 생겼을 때, 신속하고 예측 가능한 방식으로 교체 서버를 추가할 수 있다.
- EC2의 서비스 수준 계약(SLA)의 리전별 가용성은 99.95%에 이른다.

5. 보안성

- EC2 클라우드에서 실행되는 모든 것에는 보안이 적용되며, Amazon VPC와 네트워크 보안 설정을 추가해 보안의 수준을 높일 수 있다.

6. 다양한 인스턴스 타입

- 운영체제, 소프트웨어 패키지, CPU, 스토리지 크기, 메모리 크기 등이 다른 다양한 인스턴스 중에서 선택할 수 있다.
- 또 Amazon Marketplace에서 서드 파티 벤더가 제공하는 다양한 서버 패키지를 선택할 수 있다.

7. 통합

- Amazon EC2는 S3, VPC, Lambda, Redshift, RDS, EMR 등 다양한 AWS 서비스와 통합해 사용할 수 있다.

8. 비용 효율성

> EC2가 지원하는 운영체제

- Windows
- Amazon Linux
- Debian
- SUSE
- CentOS
- Red Hat Enterprise Linux
- Ubuntu

> Amazon EC2 인스턴스 타입과 특징

Amazon EC2의 다양한 인스턴스 타입은 크게 다음과 같이 분류할 수 있다.

- 범용 인스턴스
- 컴퓨트 최적화 인스턴스
- 메모리 최적화 인스턴스
- 스토리지 최적화 인스턴스
- 고성능 컴퓨트 인스턴스

1. 범용 인스턴스(T3, T3a, T2, M6g, M5, M5a, M5n, M4, A1)

일반적인 목적으로 설계된 다수의 애플리케이션에 적용할 수 있도록 컴퓨팅 파워와 메모리, 네트워크 등 리소스의 균형을 맞춘 인스턴스 타입이다.

이 타입 중 대표적인 T3와 T2는 평균 수준의 CPU 파워를 기본으로 하되, 처리량 급증 시 이 수준을 능가할 수 있는 성능 가속 기능을 추가한 인스턴스 타입이다.

T3와 T2는 완전 CPU 활성화가 필요 없는 워크로드에 적합하며, 웹 서버 또는 개발 환경 등에 사용할 것을 권장한다.

또 다른 범용 인스턴스인 M5, M5n, M4는 웹 사이트 빌드, 개발 환경, 서버 빌드, 코드 저장소, 마이크로서비스, 테스트 환경 등 다양한 용도로 사용할 수 있다.

M5, M5n, M4 는 T3 또는 T2 같은 성능 가속 기능은 제공하지 않는다.

2. 컴퓨트 최적화 인스턴스(C6g, C5, C5a, C5n, C4)

고도의 컴퓨팅 파워가 요구되는 워크로드를 처리하기 위한 인스턴스 타입이다.

3. 메모리 최적화 인스턴스(R6g, R5, R5a, R4, X1e, X1, High Memory, Z1d)

메모리 최적화 인스턴스는 고성능 메모리가 요구되는 워크로드를 처리하기 위한 인스턴스 타입이다.

메모리에서 막대한 양의 데이터를 처리하는 애플리케이션의 경우 메모리 최적화 인스턴스가 적합하다.

4. 스토리지 최적화 인스턴스(l3, l3en, D2, H1)

로컬 스토리지에서 대규모 데이터 세트를 순차적 읽기 및 쓰기 방식으로 접근하는 것과 같은 워크로드를 처리하기 위한 인스턴스 타입이다.

스토리지에 최적화돼 있으므로 매우 낮은 전송 지연 및 랜덤 IOPS 수준을 보인다.

5. 고성능 컴퓨팅 인스턴스(P3, P3, Inf1, G4, G4, F1)

머신러닝, 세포 모델링, 유전공학, 유체역학, 자율주행, 신약개발, 지질탐사, 금융공학 등 탁월한 수준의 컴퓨팅 파워가 요구되는 워크로드를 처리하기 위한 인스턴스 타입이며, 높은 비용을 지불할수록 더 높은 수준의 컴퓨팅 파워를 활용할 수 있다.

> 프로세서 특징

EC2 인스턴스는 인텔 프로세서를 사용하므로 인텔이 제공하는 모든 프로세서의 특징적 기능을 사용할 수 있다.

EC2 인스턴스에서 사용할 수 있는 프로세서의 특징은 다음과 같다.

1. Intel AES New Instructions(AES-Nll)

AES 알고리즘에 적용된 신규 암호화 기능은 기존 버전에 비해 우수하며, 신속한 데이터 보호 기능 및 향상된 보안 성능을 제공한다.

2. Intel Advanced Vector Extensions(AVX)

인텔 AVX는 이미지 및 오디오/비디오 프로세싱 애플리케이션의 성능을 높여준다.

3. Intel Tubo Boost Technology

인텔 터보 부스트 기술은 워크로드 및 트래픽 급증 등 필요시에 즉각적으로 성능을 높일 수 있게 해준다.

4. Intel Deep Learning Boost

AI 딥러닝에 최적화된 프로세서다.

> 네트워크 특징

EC2 인스턴스는 항상 VPC 내부에 론칭하는게 좋다. 이는 Amazon VPC가 IP 주소 공간 관리를 위한 훌룡한 통제 기법을 제공하며, 서브넷을 이용한 네트워크 영역 세분화, 네트워크 레벨의 보안성 제공 등 기능을 제공하기 때문이다.

대역폭을 최대화하고, 높은 네트워크 성능을 위해 배치 그룹에서 인스턴스를 론칭할 수 있다.

배치그룹(플레이스먼트 그룹)은 단일 AZ 내에서 인스턴스를 논리적 그룹으로 묶는 방법으로, 낮은 지연성과 높은 수준의 네트워크 처리 기능을 제공한다.

> 스토리지 특징

아마존은 사용자의 워크로드에 따라 EC2 인스턴스와 함께 사용할 수 있는 다양한 스토리지를 제공한다.

EC2 인스턴스에 부착해 사용하는 블록 스토리지는 Amazon EBS다.

인스턴스에 EBS 볼륨을 부착하면 물리적인 하드 드라이브와 같은 프라이머리 스토리지로서 기능을 담당하게 된다.

1. 범용 스토리지 (GP2) 

SSDs 기반의 범용 EBS 볼륨으로 기업의 일반적인 목적에 적합하다.

범용 스토리지는 아마존의 모든 EC2 인스턴스에서 기본 설정으로 사용할 수 있다.

GP2로 부르기도 하며, PIOPs보다 비용 효율적인 스토리지다.

낮은 비용으로 높은 성능을 내기 위해 다수의 GP2 볼륨을 결합해 사용하기도 한다.

2. 프로비전 IOPS(PIOPS) 스토리지

데이터베이스 워크로드 실행 등 대량의 I/O 작업이 수반되는 컴퓨팅 작업을 해야 한다면 프로비전 IOPS 기반 EBS 볼륨을 탑재해 

I/O 성능을 최대화하고 데이터베이스 또는 애플리케이션에서 요구하는 IOPS 성능을 제공할 수 있다.

3. 마그네틱 스토리지

전통적으로 사용된 마그네틱 하드 드라이브는 다른 볼륨 타입에 비해 기가바이트당 비용이 가장 낮다.

개발 워크로드 실행의 준비 프로젝트, 중요성이 낮은 워크로드, 데이터 접근이 잦은 다른 워크로드 처리에 적합하다.


> Amazon EC2 가격정책

아마존은 인스턴스의 사용 기간, 지불 방법의 유연성에 따라 다양한 가격 옵션을 제공한다.

가격 정책은 다음과 같이 크게 세 가지로 나눌 수 있다.

- 온디맨드 인스턴스
- 예약 인스턴스
- 스팟 인스턴스

> 공유 테넌시, 전용 호스트, 전용 인스턴스

EC2는 가상 환경에서 실행되므로 하나의 물리적 서버 머신에서 여러 개의 EC2 인스턴스를 실행할 수 있다.

규정 요건 충족등을 위해 물리적인 서버 수준에 비해 가상화된 인스턴스의 성능이 다소 낮아질 수 있는데, 이러한 문제는 전용 호스트 및 전용 인스턴스를 사용하면 해결된다.

1. 공유 테넌시

사용자가 EC2 인스턴스를 론칭하면 기본적으로 적용되는 가상화 조건으로 EC2 인스턴스를 멀티 테넌시 하드웨어에서 실행한다. 

기업 사용자가 가장 많이 선택하는 방식은 전용 호스트이다.

2. 전용 호스트

특정 사용자에게만 배타적으로 할당된 물리적 서버이며, 기업의 필요에 따라 다양한 소프트웨어를 탑재해서 사용할 수 있어 비용 효율성이 높다.

사용자에게 할당된 물리적 서버에 자신이 원하는 만큼의 가상 머신을 생성할 수 있다는 것도 큰 장점이다.

전용 호스트는 온디맨드 또는 예약 인스턴스 방식으로 이용할 수 있다.

3. 전용 인스턴스

전용 인스턴스는 단일 테넌트 하드웨어에서 EC2 인스턴스를 실행하며, 개별 사용자에게만 할당된 하드웨어 VPC에서 Amazon EC2 인스턴스를 실행한다,

전용 인스턴스는 다른 AWS 사용자와 하드웨어 레벨의 물리적으로 격리된 환경에서 실행된다.

베어 메탈 인스턴스는 전용 인스턴스를 활용하는 방법이 되기도 한다. 이름에서 알 수 있든 베어 메탈 인스턴스는 하이퍼바이저가 없으므로 서버의 프로세서 및 메모리 자원에 직접 접근할 수 있다는 장점이 있다.

> 인스턴스와 AMI

Amazon 머신 이미지는 아마존 클라우드에서 실행되는 서버에 대한 모든 소프트웨어 환경 설정 정보를 포함한 기본 설계도 또는 청사진과 같다.

예를 들어, AMI에는 운영체제, 애플리케이션 서버 그리고 그 위에서 실행되는 애플리케이션 등에 대한 세부 내용을 모두 담고 있다.

AMI로 서버 또는 인스턴스를 론칭하면 그에 필요한 모든 요소가 상속돼 만들어진다.

사용자는 AMI를 통해 자신이 원하는 수만큼 인스턴스를 생성할 수 있다.

AMI에는 인스턴스의 루트 볼륨이 포함돼 있으며, 루트 볼륨에는 운영체제와 애플리케이션 서버 또는 리눅스, 아파치, MySQL, PHP로 구성된 LAMP 스택, 기타 커스텀 애플리케이션 등 운영체제 위에서 실행되는 소프트웨어가 모두 포함돼 있다.

AMI에는 어떤 AWS 계정에서 AMI를 통해 인스턴스를 론칭할 수 있는지 정의한 인스턴스 론칭 승인 정보가 포함돼 있다.

론칭 승인 정보는 다음과 같이 나눈다.

1. 퍼블릭 : 소유자가 모든 AWS 계정 사용자에서 론칭 승인을 부여
2. 명시적 : 소유자가 특정 AWS 계정 사용자에게만 론칭 승인을 부여
3. 암묵적 : 소유자가 암묵적으로 AMI를 통한 론칭 승인을 부여

> AMI에서의 가상화

리눅스 AMI는 다음과 같은 두 가지 타입의 가상화 기법을 사용한다.

1. 하드웨어 가상화 머신 (HVM)
2. 부분 가상화 (PV)

> 인스턴스의 라이프 사이클

1. 인스턴스 론칭
2. 시작 및 정지
3. 재부팅
4. 인스턴스 삭제
5. 인스턴스 폐기

> 시큐리티 그룹

하나 혹은 다수의 인스턴스에 대한 트래픽을 통제하는 가상의 방화벽이다.

> Amazon Elastic Container Service

ECS는 Amazon EC2 클러스터에서 도커 컨테이너를 관리할 수 있게 해주는 컨테이너 관리 서비스다.

* 참고 : https://aws.amazon.com/ko/ec2/instance-types/
