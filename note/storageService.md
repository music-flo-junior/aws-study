# AWS 공인 솔루션스 아키텍트 올인원 어소시에이트

## 2장. AWS 스토리지 서비스

AWS의 스토리지 서비스는 세 개의 카테고리로 나눌 수 있다.

> 객체 스토리지

- 여기서 객체란 ? 문서, 이미지, 비디오 등 비교적 단순한 구조에 메타데이터를 포함하고 있는 데이터 조각을 의미하며, 인터넷으로 연결된 API를 통해 데이터를 애플리케이션에 제공한다.
- 객체 스토리지의 활용 방법은 간단하다. 
- 예를 들어, Amazon S3 위에서 작동하는 웹 애플리케이션을 만들어 인터넷으로 요청받은 API 호출에 따라 사용자에게 콘텐츠를 제공할 수 있다.

> 블록 스토리지

- 블록 스토리지에서 데이터란 서버 인스턴스에 디스크 볼륨 형태로 제공되는 데이터를 의미하며, 이를 통해 EC2 인스턴스에 포함된 볼륨에 고속으로 접근할 수 있다.
- 블록 저장의 대표적 서비스인 EBS는 EC2 인스턴스를 위한 부트 볼륨 및 데이터베이스로 널리 사용된다.

> 파일 스토리지

- 파일 스토리지에서 데이터란? 서버 인스턴스에 파일 시스템 인터페이스 또는 파일 시스템 시멘틱스 방식으로 제공되는 데이터를 의미하며, 서버 인스턴스에 파일 스토리지를 추가하면 로컬 파일 시스템 처럼 작동한다.
- EFS(ElasticFileSystem)은 고속으로 다수의 EC2 인스턴스를 통해 데이터에 접근할 수 있도록 한다.

### Amazon Simple Storage Service(S3)

아마존의 대표적인 스토리지 서비스인 S3는 2006년에 소개됐으며, 객체 스토리지이자 아마존의 주요 서비스를 연결하는 핵심 요소다. 전 세계 어디에서나 대규모 데이터를 저장하고 인출할 수 있는 인터페이스를 제공한다. S3의 저장 용량은 무제한이며, 99.99999%에 이르는 고신뢰성을 제공한다. 

이는 연평균 0.000000001%의 객체 데이터가 손실될 확률 수준을 의미한다.

- S3는 두 개의 저장 시설에서 동시다발적인 손실 상황을 견디도록 설계됐다.


- S3는 다른 저장소와 근본적으로 다른 방식의 설계를 따르고 있는데, 바로 파일 시스템이 존재하지 않고 모든 객체는 S3 버킷에 단순한 네임스페이스만으로 저장되는 점이다.


- 또한 S3는 지역별 서비스로서 지역별 재난 상황에 대처할 수 있도록 자동 반복 저장된다. S3는 현시점을 기준으로 인터넷에서 가장 널리 사용되고 있는 객체 스토리지이다.

### Amazon S3의 주요 장점

Amazon S3의 주요 장점은 다음과 같다.

> 간편성

- S3는 사용하기 편리하며, 직관적인 웹 기반 콘솔을 이용해 데이터 업로드, 다운로드, 관리 등의 업무를 수행할 수 있으며, S3를 관리하기 위한 다수의 모바일 앱도 제공한다. S3는 서드 파티와의 통합을 위해 REST API 와 SDK도 제공하며, 리눅스 스타일의 인터페이스인 AWS CLI를 제공한다.

> 확장성

- S3는 무제한의 확장성을 지니며, 별도의 준비 작업 없이도 무제한의 데이터를 저장할 수 있다.
- S3에 페타바이트급 데이터를 저장하는 작업도 쉽고 간단한다.
- 또한 비즈니스 니즈에 맞춰서 언제든 저장 용량을 확장 및 축소할 수 있다.
- S3는 무제한으로 확장할 수 있도록 설계됐다.

> 신뢰성

- S3는 99.9999999%의 신뢰성으로 객체를 저장할 수 있는 유일한 서비스로 이를 위한 아마존만의 인프라 설계 및 운영 능력이 발휘되고 있다.
- 데이터는 반복 방식으로 다수의 데이터 센터와 다수의 스토리지 기기에 저장되며, 두 개 시설에서 동시에 재난 상황이 발생해도 데이터가 안전하게 보관되도록 한다.

> 보안성

- S3는 암호화 기능을 제공하며, 모든 데이터는 업로드될 때 자동으로 암호화된다.
- 또한 SSL을 통한 데이터 전송을 지원하고 아마존의 신분확인 및 접근관리 서비스인 IAM을 통해 S3 버킷에 대한 매우 세심한 접근 권한 관리기능을 제공한다.

> 고성능

- 네트워크 성능을 최대한 활용할 수 있는 멀티파트 업로드 기능을 지원하고, 지역별 네트워크 지연을 최소화할 수 있도록 최종 사용자의 인접 리전을 고객이 선택할 수 있게 한다.
- 또한 S3와 CloudFront를 연계해 고정 비용없이 최종 사용자에게 고속으로 콘텐츠를 전송할 수 있도록 한다.

> 가용성

- 가용성(Availability)이란 정상적인 사용 시간(Uptime)을 전체 사용 시간(Uptime+Downtime)으로 나눈 값을 말한다. 이 값이 높을수록 "가용성이 높다"고 표현한다. 
- S3는 객체 저장과 관련해 연간 99.99%의 가용성을 지니도록 설계됐으며, SLA(서비스 수준 합의서)상의 99.99% 활용성 및 가용성은 아래와 같은 비활용성 및 비가용성 수준을 의미한다.
- 일간 : 8.6초 / 주간 : 1분 0.5초 / 월간 : 4분 23.0초 / 연간 : 52분 35.7초  

> 저비용

- S3는 높은 비용대비효율성을 제공하며 대량의 데이터를 저비용으로 저장할 수 있다.

> 관리 용이성

- S3의 스토리지 관리 기능을 이용하면 스토리지를 최적화하고 보안 및 관리의 효율성을 증대시킬 수 있다.
- 결과적으로 데이터에 대한 인사이트를 높이고 더 개인화된 메타데이터를 활용할 수 있다.

> 연계성

- S3는 다른 서드 파티 도구와 손쉽게 연계할 수 있으며, S3 기반의 다양한 애플리케이션을 신속하게 개발 및 배포할 수 있다.
- S3는 다른 AWS 서비스와의 연계성도 높으므로 다양한 AWS 제품군과 결합해 우수한 서비스를 구현할 수 있다.

### Amazon S3의 실무 활용 방법

Amazon S3의 활용 방법은 아래와 같다.

> 데이터 백업

- Amazon S3는 기업용 데이터 백업 파일 저장 방식으로 널리 활용된다.
- 99.9999999% 의 신뢰성을 제공하므로 데이터 손실 가능성이 매우 희박하며, S3 Standard, S3 Standard-Infrequent Access, S3 Glacier 스토리지 클래스 모두 리전 내 여러 개의 AZ로 분산돼 세 개의 복제물로 관리되므로 특정 AZ가 자연재해 등으로 파괴돼도 데이터는 안전하게 보관된다. 또한 버전 별 관리 기능을 제공하므로 인간의 행동 오류에 의한 손실 가능성 또한 매우 낮다.

> 테이프 저장 장치 대체

- 오늘날 S3의 주요 용도 중 하나는 전통적인 테이프 저장 장치의 대체물이다.

> 정적 웹사이트 호스팅

- S3만 있으면 웹 서버 설정이나 스토리지에 대해 고민할 필요 없이 정적 웹사이트 호스팅이 가능하다.
- 또한 S3는 필요에 따라 언제든 확장 가능하므로 트래픽 제한이나 용량 제한을 고민할 필요가 없다.
- 예를 들어, S3에 *.html 파일을 저장하면 사용자는 웹 서버 없이 웹 브라우저만으로 접속 가능하다.
- 이는 읽기만 가능한 데이터에 대해 특히 유용한 기능이다.

> 애플리케이션 호스팅

- S3는 고가용성 스토리지로서 다수의 고객이 모바일 앱 또는 인터넷 기반 앱을 호스팅하는 데 이용할 수 있다.
- 또한 S3는 전 세계 어디서나 접근 가능하므로 애플리케이션을 세계 어디에서나 접근 및 배포할 수 있다.

> 재난 복구

- S3는 재난 복구 전략으로도 활용되며, 크로스 리전 복제 전략으로 각각의 S3 객체를 서로 다른 리전, 서로 다른 버킷에 자동으로 복제할 수 있다.

> 콘텐츠 배포

- S3는 인터넷을 통한 배포 방법으로도 활용되며, 기업의 모든 스토리지 인프라를 클라우드로 이전해 S3의 고확장성, 사용량에 따른 비용 부담의 혜택을 누릴 수 있다.

> 데이터 레이크

- S3는 최근 데이터 레이크로서의 인기가 급증하고 있다. 데이터 레이크는 기업에서 처리, 분석, 소비되는 막대한 양의 데이터를 보관하는 중앙 저장소라 할 수 있다.

> 프라이빗 저장소

- S3를 이용해 Git, Yum, Maven과 같은 프라이빗 저장소를 구현할 수 있다.

### Amazon S3의 기본 개념

실생활에서 물을 양동이에 담듯, 클라우드에서는 객체 데이터를 버킷에 담는다.
S3에서 버킷은 객체를 저장하는 컨테이너 역할을 하며, 컴퓨터로 비유하자면 파일을 담는 폴더 역할을 수행한다.

폴더에 여러 개의 폴더를 담을 수 있듯, 버킷에도 여러 개의 폴더를 생성할 수 있다.

버킷 사용 시 주의점은 버킷의 이름을 붙일 때 여러 리전에서 유일무이한 이름을 사용해야 한다는 것이다.
그러면 사용자는 버킷 URL을 통해 해당 데이터를 접근할 수 있다.

예를 들어, newringtones라는 버킷에 ringtone, mp3 객체를 저장하면 아래와 같은 URL이 생성된다.

- http://newringtones.s3.amazonaws.com/ringtone.mp3

> 버킷 사용 목적

- S3 네임스페이스의 최상위 레벨
- 비용을 부담하는 계정을 표시
- 엑세스 컨트롤에서 역할 수행
- 사용량 보고서에서 누적 유닛 표시

버킷은 어떤 리전에서도 생성할 수 있으며, 명시적으로 복제 작업을 수행하거나 크로스 리전 복제를 수행하지 않는 한 다른 리전에 특정 버킷의 데이터가 복제되기 않은다.

또한 S3 버킷은 버전 부여 기능을 제공하므로 객체가 버킷에 추가될 때마다 해당 객체에 유일한 ID가 할당된다.

S3에서 객체는 가장 기본적인 요소로 버킷에 저장한 모든 것을 객체라 부르고, 각 객체는 데이터와 메타 데이터를 지닌다.
이때 데이터는 S3에 저장되는 것이고, 메타데이터는 해당 객체를 설명하는 네임 밸류 쌍으로 표시한다.

메타데이터에는 최종 수정일, 파일 타입 등 부가 정보가 기록된다. 버킷 내에서 객체는 이름, 키, 또는 버전 ID를 통해 식별할 수 있다.

객체는 키를 통해 버킷에서 유일한 것으로 식별될 수 있으며, 버킷에 존재하는 모든 객체는 단 하나의 키를 지닌다.
따라서 S3 내에서 버킷, 키, 버전 ID를 통해 특정 객체를 파악할 수 있다.

예를 들어, 아래와 같은 객체 URL이 있다고 하자.

- http://s3.amazonaws.com/2017-02/pictures/photo1.gif

여기서 객체의 키는 2017-02/pictures/photo1.gif가 된다. 이때 키와 파일의 버전정보를 함께 사용하면 유일무이한 특정 객체를 지정할 수 있다.

S3는 API를 통해 접근할 수 있으며, 개발자는 S3 기반의 애플리케이션을 개발할 수 있다.
S3의 기본 인터페이스는 REST API이며, HTTPS 모드에서 SOAP API를 지원한다.
하지만 새로운 S3에서는 SOAP를 지원하지 않을 계획이므로 REST 방식을 사용할 것을 권장한다.

### Amazon S3 데이터 일관성 모델

S3 인프라는 기본적으로 복수의 AZ 위에 다수의 로드 밸런서, 웹 서버, 스토리지로 구성된다.
전체 아키텍처는 신뢰성을 위해 중복 구현되며 각 데이터는 위치가 다른 복수의 AZ에 저장된다.

객체를 작성하면 가장 먼저 로드 밸러서와 연결되고, 다음으로 웹 서버의 API에 연결되며, 마지막으로 다수의 AZ에 있는 다수의 스토리지에 중복 저장된다. 이에 대한 예외는 S3-One Zone Infrequent Access 서비스가 있으며, 여기서 단일 AZ에만 데이터를 저장한다.

저장이 되면, 인덱싱 작업이 진행되고, 그 내용 또한 다수의 AZ와 스토리지에 중복 저장된다.
이때 어떤 이유에서든 로드 밸랜서 또는 웹 서버가 다운되면,S3는 중복 구현된 또 다른 로드 밸런서 또는 웹 서버에 요청을 보내고, 스토리지 유닛 또는 인덱싱 스토리지가 다운되면, 중복 구현한 또 다른 스토리지에 저장된다.

연동된 전체 AZ가 다운돼 시스템 페일오버가 발생하면, 전체 시스템이 복제돼있는 또 다른 복수의 AZ를 통해 해당 서비스를 제공하게 된다.
이것이 바로 '한번 기록하고 여러번 읽는' 아키텍처의 작동방식이다. 

(즉, 여기저기 복제되므로 한번 기록하면 여기저기서 읽을 수 있다~!)

> 판독 일관성(read-after-write consistent)

새 객체를 작성하면 데이터는 동기적으로 다수의 클라우드 설비에 저장된다.
이는 기록 후 판독 일관성을 제공한다.

> 종국적 일관성(eventually consistent)

S3는 기존의 다른 모든 객체를 위해 종국적 일관성 모델을 제공한다. 종국적 일관성 모델에서는 데이터가 자동으로 복제돼 동일 리전 내 다수의 시스템 및 다수의 AZ에 확산되므로 최신 내용으로 변경한 내용이 즉각적으로 반영되지 않거나 업데이트 직후 데이터를 읽으려 할 때 변경된 내용을 확인할 수 없게 될 가능성이 있다.

예를 들어, PUT 요청이 성공하면 데이터는 안전하게 저장된 것이고, 해당 데이터가 사라질 걱정은 할 필요가 없어진다.
일관성 모델을 이해하기 위해 아래 사례를 살펴보자.

- S3에 새 객체를 작성하고, 즉시 이에 대한 읽기를 시도해 보자. 변경 사항이 완전히 확산되기 전까지 S3는 key does not exist 라는 메시지를 출력할 것이다.

- S3에 새 객체를 작성하고, 즉시 버킷의 키 리스트를 출력해보자. 변경 사항이 완전히 확산되기 전까지 해당 객체가 리스트에 나타나지 않을 것이다.

- 기존의 객체를 삭제한 뒤, 즉시 이에 대한 읽기를 시도해 보자. 변경 사항이 완전히 확산되기 전까지 S3는 삭제를 명령한 데이터를 반환할 것이다.

- 기존의 객체를 삭제한 뒤, 즉시 버킷의 키 리스트를 출력해 보자. 변경 사항이 완전히 확산되기 전까지 S3는 삭제를 명령한 객체도 리스트로 출력할 것이다.

> 아토믹(Atomic) 특성

업데이트의 경우, 단일 키에 대한 업데이트는 아토믹 특성을 보인다.
예를 들어, 기존 키를 PUT할 경우 최종 읽기 실행 결과는 업데이트 전 데이터 또는 업데이트 후 데이터만 나타날 수 있으며, 일부만 수정도리 가능성은 없다.

> 객체 잠금 기능 미지원

S3 사용 시 또 하나의 주의 점은 객체 잠금 기능을 지원하지 않는다는 것이다.
동일 파일에 대해 동시다발적으로 업데이트(PUT) 요청이 있는 경우, 최종 타임 스탬프를 지닌 요청을 따른다.
S3 자체적으로는 객체 잠금 기능을 제공하지 않지만, 애플리케이션 레벨에서는 해당 기능을 구현할 수 있다.

### Amazon S3 성능 고려

S3 버킷에 초당 100회 이상의 PUT/LIST/DELETE 요청을 하거나 300회 이상의 GET 요청을 해야한다면, 해당 작업의 워크로드를 적절히 파티셔닝, 즉 분산할 수 있는 방법을 고려해야 한다.

Amazon S3는 매우 높은 수준의 요청 처리능력을 제공하며, 이를 위해 S3는 모든 버킷을 자동으로 파티셔닝한다.

> 키 프리픽스 / 전치사를 기준으로 저장 위치 파티셔닝

> 키 이름 문자열의 역순 배열하여 파티셔닝

> 키 이름에 Hex Hash 프리픽스 추가하여 파티셔닝

### Amazon S3의 암호

Amazon S3에서 데이터를 암호화하는 방법은 크게 두 가지가 있다.

> 전송 중인 데이터를 암호화 하는 것
- 데이터가 한 지점에서 다른 지점으로 이동할 때의 암호화


- HTTPS 또는 SSL 암호화 종단점에서 데이터를 업로드하면, 모든 업로드 및 다운로드 데이터는 자동으로 암호화되고 전송 중에도 암호화 상태를 유지한다.
S3 암호화 클라이언트를 이용해 S3 버킷에 업로드하기 전에 암호화를 한 경우 전송 중에도 암호화 상태가 유지된다.
이는 S3에 안전하게 데이터를 저장하기 위한 클라이언트 측 암호화 방식이며, 데이터는 각각의 S3 객체마다 1회성 랜덤 CEK, 즉 콘텐츠 암호화 키를 이용해 암호화된다.
CEK를 보호하기 위해 AmazonS3EncryptionClient 클래스의 구조체 내에 마련된 암호화 로직이 사용되고, 이는 S3 객체와 함께 저장된다.

> 저장된 데이터를 암호화 하는 것
- 데이터 또는 객체가 S3 버킷에 저장돼 대기상태일 때의 암호화


- 저장된 데이터의 암호화는 SSE, 즉 Server Side Encryption을 이용하고 데이터를 작성할 때 자동으로 암호화되며, 데이터를 인출할 때 자동으로 복호화된다. 
이때는 AES 256-비트 대칭키가 사용되며, 다음과 같은 세 가지 방식으로 키를 관리한다.

1. Amazon S3 키 매니지먼트 기반의 SSE(SSE-SE) 

Amazon S3가 저장된 데이터를 암호화하고, 암호화 키 또한 관리하는 방식이다 각각의 객체는 객체별 키를 통해 암호화 되며, 객체별 키는 마스터 키로 암호화되며 S3 키 매니지먼트를 통해 해당 마스터 키를 관리한다.

2. 고객 자체 생성 키 기반의 SSE(SSE-C)

고객이 자체 생성한 커스텀 암호화 키로 데이터를 암호화 하는 방식이다.

3. AWS KMS 기반의 SSE(SSE-KMS)

AWS의 키 매니지먼트 전문 서비스인 KMS를 이용한다.

### Amazon S3의 접근성 통제

엑세스 컨트롤, 즉 접근성 통제란 S3 버킷에 누가, 어떻게 접근하도록 할 것인지 정의하는 것이다.

> 접근 정책

IAM, 즉 신분 및 접근 관리 정책으로 S3의 객체를 매우 세분화해 통제할 수 있다.
먼저 유저, 그룹, 롤 등 IAM 정책을 정의한다.

IAM과 S3를 이용하면 특정 IAM 유저와 공유되고 있는 버킷을 선택할 수 있고, 특정 유저가 해당 버킷에 접근하도록 허용할 수 있다.
또한 특정 버킷의 내용을 회원 모두 또는 일부 회원이 열람하도록 할 수 있고, 고객 또는 파트너가 특정 버킷에 객체를 추가하도록 허용할 수 있다.

정책 작성에 앞서 즉 아마존 리소스 이름 (ARN)을 알고 있어야 한다.

####ARN 

ARN은 AWS 리소스를 위한 유일무이한 이름이며, AWS 사용자는 IAM 정책 수립, API 호출 등 특정 리소스에 접근하기 위해 해당 이름을 정확히 알고 있어야 한다.

ARN은 다음과 같은 형식을 지닌다.

- arn:partition:service:region:account-id:resource 
- arn:partition:service:region:account -id:resourcetype/resource

1. partition

해당 리소스가 포함된 파티션을 의미, 표준 AWS 리전에서 파티션은 aws이다.

다른 파티션에 리소스가 있을 경우, 해당 파티션은 aws-partitionname이 된다. 

예) aws-cn : 중국 리전

2. service

AWS 제품을 구분할 수 있는 서비스 네임스페이스다.

Amazon S3의 서비스 이름은 s3이며, region은 리소스가 포함된 영역으로 선택적으로 사용할 수 있다.

일부 ARN은 리전을 명시할 필요가 없으므로 생략 가능하다.

3. account

해당 리소스를 소유한 AWS 계정의 ID로 331983991과 같이 표기하고 하이픈 기호는 사용하지 않는다.

4. resourcetype:resource 또는 resourcetype/resource에서 resource

콘텐츠를 의미하며, 서비스의 종류에 따라 다르게 사용한다.

이는 리소스 유형을 나타내기 위한 방법이며, IAM 유저 또는 Amazon RDS 데이터 베이스의 경우 슬래시 또는 세미콜론 기호를 붙이고 리소스 이름을 붙인다.

####S3 ARN 표기법 사례

ARN내의 계정 또는 리전 정보는 필요로 하지 않는다.
- arn:aws:s3:::bucket_name/key_name

> 버킷 정책

버킷 정책이란 버킷 레벨에서 생성한 정책을 의미하며, S3 버킷을 세분화된 방식으로 제어할 수 있게 해준다.

IAM 없이 버킷 정책만으로도 맥락에 따른 사용자 접근 제한이 가능하며, 심지어 다른 AWS 계정 또는 IAM 유저에게 특정 객체 또는 폴더 속 데이터에 대한 접근 권한을 부여할 수도 있다.

버킷 정책을 생성하면 사용자가 생성한 객체에 대해서만 접근 권한을 통제할 수 있다.

> 접근 제어 목록

접근 제어 목록(ACL, Access Control List)는 각각의 버킷과 그 속에 포함된 객체는 ACL과 연동되므로 ACL을 통해 S3의 버킷 레벨 또는 객체 레벨에서 접근을 제어할 수 있다.

넓은 범위의 제어에 초점을 맞추고 있으며, 단지 접근 승인을 한 곳과 접근 승인을 받은 곳으로만 나타낼 수 있다.

버킷 정책과 접근 제어 목록은 S3 리소스에 부착하는 방식으로 사용하므로 리소스 기반 정책으로 분류된다.

####S3 보안의 베스트 프랙티스

Amazon S3에는 온갖 종류의 데이터가 저장돼 있으므로 안전하게 데이터를 보호화는 것이 무엇보다 중요하다.

다음은 S3에서 데이터를 안전하게 보호하는 전략이다.

- S3 버킷에 대한 퍼블릭 액세스를 허용해서는 안된다. 아무에게나 노출되기 때문이다.

- Amazon S3 Block Public Access 기능을 이용해 S3 버킷에 대한 퍼블릭 액세스를 효과적으로 제한할 수 있다.
- '최소한의 접근 권한' 전략을 사용한다.
- 다중인증 시스템을 활용한다.
- S3 버킷에 대한 감사를 수행한다.
- IAM 룰을 활용한다.

### Amazon S3 스토리지 클래스

Amazon S3는 다양한 상황에 대응할 수 있도록 다양한 스토리지 클래스를 제공한다.

1. Amazon S3 Standard

AWS의 기본형 스토리지로 빈번하게 접근하는 데이터를 위한 고신뢰성, 고가용성, 고성능을 제공한다.
S3 클래스 중 가장 많은 시용자가 선택하는 클래스이며, 웹사이트, 콘텐츠 스토리지, 빅데이터 분석, 모바일 애플리케이션 등 다양한 용도로 사용된다.

2. Amazon S3 Standard IA 

Infrequent Access의 약자로 다른 클래스에 비해 상대적으로 접근 빈도가 낮은 데이터를 위한 스토리지 클래스이다.

비용이 저렴하므로 장기저장, 백업, 재해복구 등의 목적으로 활용된다.

라이프 사이클 정책을 통해 파일을 Standard 에서 Standard IA로 이동 시킬 수 있다.

* 스토리지 클래스는 S3 객체의 다앙한 속성에 대응하기 위한 클래스다. 
* 클래스가 다르더라도 S3 버킷이 달라지는 것은 아니며 Standard에서 Standard IA로 이동할 때도 동일한 URL을 시용한다. 
* 따라서 따일을 이동시키고자 애플리케이션 쿄드를수정하거나 다른 URL을 설정할 필요는 없다.

3. Amazon S3 One Zone-IA

최근 추가된 One Zone-IA는 평소에 낮은 빈도로 접근하지만, 때에 따라서 매우 신속하게 접근할 수 있는 스토리지 클래스다.

세 개의 AZ에 분산 복제되는 Standard 클래스와 달리 One Zone-IA는 말 그대로 단일 AZ에만 저장되므로 비용이 저렴하다.

4. Amazon S3 Intelligent-Tiering

Amazon S3 Intelligent-Tiering은 데이터에 대한 엑세스 패턴에 따라 자동으로 하나의 스토리지에서 다른 스토리지로 이동시켜 비용을 최적화한다.

5. Amazon S3 Glacier

데이터 아카이브, 즉 데이터 장기보관을 목적으로 활용된다.

6. Amazon S3 Glacier Deep Archive

장기 아카이브 스토리지다. 예를 들어, 법규에 의해 특정 업무와 관련된 모든 데이터를 7년 또는 10년간 보관해야 하는 경우 유용한 선택안이 될 수 있다.

> 스토리지 클래스 이동 방법

- S3 라이프 사이클 정책 생성
- AWS CLI에서 S3 복제 명령(aws s3 cp) 실행 
- Amazon S3 콘솔 활용
- SDK 활용

###Amazon S3에서의 객체 버전 관리

버저닝(Versioning)은 동일한 파일의 다양한 업데이트 상태를 관리하는 방법으로 적절한 버저닝 기법을 통해 동일 파일의 서로 다른 10가지 버전을 업로드할 수 있다.
이들 파일은 모두 S3 버킷에 저장되며, 각각의 파일은 유일무이한 버전 번호를  할당 받는다. 하지만 S3 버킷에서 특정 파일을 찾을 때는 서로 다른 10가지 버전이 아닌 원하는 단 하나의 파일만 찾을 것 이다.

S3 버킷에서 특정 파일을 찾을 때는 서로 다른 10가지 버전이 아닌 원하는 단 하나의 파일만 찾을 것이다. S3는 하나의 파일에 존재하는 모든 버전을 저장하며, 다양한 버전 옵션을 통해 필요로 하는 파일만 찾고 다운로드 할 수 있도록 도와준다.

버저닝을 통해 파일을 보존하고 인출하는 것뿐만 아니라 모든 버전의 파일을 안전하게 복원할 수 있도록 돕는다. S3는 버킷에 있는 기존의 파일에 PUT, POST, COPY, DELETE 와 같은 작업이 실행됐을 때도 복원이 가능하도록 버저닝 기능을 지원한다.

GET 요청은 기본 설정에 의해 최신 버전의 파일을 가져오며, 콘솔을 통해 파일을 다운로드한 경우 해당 파일의 최신 버전만 보여준다. 이전 버전의 파일이 필요한 경우, GET 요청 시 세부적인 버전 정보를 추가하면 된다.

일단 버저닝을 활성화하면 다시 비활성화할 수 없으며, 객체 버저닝 작업이 중단되도록 할 수는 있다.

버저닝은 버킷 레벨에서 실행되는데, 만일 S3 버킷에 수천 개의 객체를 가지고 있다면 일부 파일에 대해서만 버저닝이 필요할 수 있다. 이럴 때는 버전이 필요한 파일만 별도의 버킷에 저장해 버전 관리를 하는 것이 좋으며, 수천 개의 파일이 불필요하게 버저닝 되는 것을 피할 수 있다.

###Amazon S3의 객체 라이프 사이클 관리

라이프 사이클 매니지먼트를 활용하면 S3의 성능을 극대화하면서 비용은 줄일 수 있다.
스토리지와 관련된 다양한 정책을 생성하고, 파일의 라이프 사이클에 따른 중요도 및 맥락에 따라 하나의 스토리지 클래스에서 다른 클래스로 이동시킬 수 있다.

라이프 사이클 정책을 통해 다음과 같은 두 가지 주요 임무를 수행할 수 있다.

1. 파일 이동

서로 다른 클래스 간에 객체 이동시키는 규칙을 추가할 수 있다.

2. 파일 소멸

객체가 소멸된 후의 사항을 정의할 수 있다.

라이프 사이클 규칙은 버킷에 추가되며, 일부 파일에만 해당 규칙이 적용되기를 원할 경우 특수한 프리픽스를 추가해 해당 프리픽스 요소에만 라이프 사이클 규칙이 적용되도록 한다.

###Amazon S3의 복제

S3 복제 기능을 이용해 S3 버킷에 저장된 모든 파일을 복사하고 다른 버킷에 자동으로 저장할 수 있다.

하나의 계정에서 다른 계정으로, 하나의 스토리지 클래스에서 다른 스토리지 클래스로 그리고 동일 리전에서 물론 하나의 리전에서 다른 리전으로 데이터를 옮겨서 저장할 수 있다.

S3 복제 작업은 외부에 드러나지 않은 채 비동기적인 방식으로 진행한다. S3 복제 기능 설정하려면 소스 버킷 및 타깃 버킷을 설정하고 복제 작업 수행에 요구되는 롤 퍼미션을 추가한다.

AWS는 S3 복제를 두 가지 유형으로 제공한다.

1. 교차 리전 복제(CRR,Cross-Region Replication) 

서로 다른 리전 간의 객체 복제에 사용 (글로벌한 사용자를 대상으로 한 서비스)

> CRR 적용 시, 고려사항

- 소스와 타깃 버킷에 버저닝 기능이 활성화돼 있어야한다.버저닝 기능이 활성화 되지 않은 경우 CRR을 사용할 수 없다.
- CRR에서 소스 버킷 오너는 복제에 사용할 타킷 리전을 지정해야 한다. SRR의 경우 이 규칙이 적용되지 않는다.
- Amazon S3 파일 복제를 위한 퍼미션 롤이 있어야 한다.
- 버킷 오너가 복제할 객체를 소유하지 못한 경우, 객체 오너가 ACL을 이용해 READ 및 READ_ACP 퍼미션을 부여한다.
- 소스 버킷에 Object Lock이 활성화돼 있는 경우 타깃 버킷도 Object Lock이 활성화돼 있어야 한다.
- 소스 버킷 및 타깃 버킷을 서로 다른 계정이 소유하고 있는 경우 타킷 버킷 오너는 소스 버킷 오너에게 객체 복제 퍼미션을 부여해야 한다.

2. 동일 리전 복제(SRR,Same-Region Replication)

동일 리전 내에서의 객체 복제에 사용 (데이터레이크)

###Amazon S3에서 정적 웹사이트 호스팅하기

Amazon S3는 서버측 스크립트를 지원하지 않으므로 정적 웹사이트만 호스팅이 가능하다.

###Amazon S3 Glacier

데이터 아카이브 및 장기보관 백업을 위한 저비용 클라우드 스토리지다.

> 다양한 산업에서 활용

1. 자기 테이프 스토리지 대체
2. 헬스케어/생명과학/과학 데이터 저장
3. 미디어 자산 아카이빙/디지털 보관
4. 규제 정책에 따른 아카이빙/장기 백업 보관

> 용어

- 볼트(Vault) : 데이터를 위한 금고 역할을 수행하는 볼트 (S3의 버킷 개념)
- 볼트 잠금(Vault Lock) : 볼트 잠금 정책을 이용해 좀 더 쉽게 볼트를 배포하고 규제 정책을 반영할 수 있다. WORM 규칙을 추가해 다른 사용자의 편집 또는 수정을 막을 수 있다.
- 볼트 인벤토리 : 아카이브 인덱스. 24시간 마다 갱신된다.
- 잡(Job) : 아카이브 또는 볼트 인벤토리에서 데이터를 인출하려면 해당 파일에 대한 인출 요청 내용을 담은 잡을 제출해야한다.

> 접속하기

1. AmazonS3Glacier API 또는 SDK를 이용한 직접 접속
2. Amazon S3 라이프 사이클 통합 서비스를 이용한 접속. 라이프 사이클 정책 설정을 통한 방법으로 S3에 있는 파일 중 3개월 또는 1년이 경과한 파일을 S3 Glacier로 이동시킨다.
3. AWS 서드 파티 도구와 게이트웨이를 이용한 접속

> 파일 업로드 하기

1. 일반적인 인터넷 연결을 통해 업로드
2. AWS Direct Connect를 이용해 기업 데이터 센터에 있는 데이터를 업로드
3. AWS Snowball을 이용해 데이터 이송하고 업로

> 파일 가져오기

1. 스탠다드 

몇 시간이 소요되는 저비용 데이터 인출 방식

2. 엑스퍼다이티드

소수의 아카이브에 대한 일시적이고 긴급한 인출 방식

3. 벌크

페타바이트급 데이터를 위한 최저비용 인출 방식

> S3 Glacier 에서 데이터 인출하기
1. 데이터 인출을 위한 리트리벌 잡 을제출한다.리트리벌 잡 제출 시 스탠다드, 엑스퍼다이티드, 벌크 타입을 설정할 수 있다. 제출을 완료하면 리트 리벌 잡을 모니터링할 수 있는 잡 ID 가 생성된다.
2. 리트리벌 잡은 선택한 S3 Glacier 인출타입에 따라 수분에서 수시간이 소요된다.
3. 리트리벌 잡이 완료되면 완료 알림 메시지가 나타난다.
4. 인출한 데이터를 다운로드한다.

###Amazon Elastic Block Store (EBS)

EC2 인스턴스를 위한 영구 스토리지 기능을 수행한다. 영구 스토리지는 EC2 인스턴스의 수명주기를 넘어서서 존재할 수 있는 스토리지의 의미이며, 신뢰성 높은 블록 레벨의 스토리지를 제공한다.

볼륨은 네트워크에 부탁돼 사용되며, 인스턴스 수명에 영향을 받지 않고 존속할 수가 있다.

EBS 볼륨은 고가용성, 고신뢰성 스토리지 볼륨으로 EC2 인스턴스의 부트 파티션으로 사용되거나 실행 중인 EC2 인스턴스의 표준 블록 디바이스로 사용된다.

EC2 인스턴스에 EBS 볼륨을 부착하면, EBS 볼륨은 서버를 위한 하드드라이브와 같은 기능을 수행하게 된다.

- 하나의 EC2 인스턴스에 여러 개의 EBS 볼륨을 부착할 수 있다.
- 다수의 EC2 인스턴스에 동일한 EBS 볼륨을 부탁할 수 없다. 유일한 예외 규칙은 다중 연결 옵션의 EBS 볼륨을 사용하는 것이다.
- 하나의 Provisioned IOPS SSD 볼륨을 동일 AZ에 있는 최대 16개의 니트로 기반 인스턴스에 추가할 수 있다.
- 서로 다른 AZ 간에는 EBS 볼륨 분리 및 부착이 불가능하다.
- EBS 볼륨은 부트 파티션으로도 사용할 수 있다.
- Amazon EBS는 볼륨에 대한 특정시점의 스냅샷을 지속적으로 작성해 S3에저장하는방식으로 다수의 AZ에서 자동복제기능을 제공한다.

###Amazon EBS 의 특징

- 영구 스토리지
- 범용성
- 고가용성 및 고신뢰성
- 암호화 지원
- 다양한 저장 용량
- 사용 편의성
- 실패 대응성

###Amazon EBS의 주요 서비스

> Amazon EC2 인스턴스 스토어

- Amazon EC2 인스턴스 스토어는 EC2 인스턴스의 로컬 스토리지다. 
- EBS 볼륨과는 달리 EC2 인스턴스 스토어는 다른서버에 부착해서 사용할수없다. 
- 일시적이며, 복제 및 스냅샷 기능도 제공되지 않는다.
- SSD 및 HDD 타입 모두 가능하다. 
- HDD (Hard Disk Drive) / SSD (Solid State Drive)

> Amazon EBS 볼륨

Amazon EBS는 실행하려는 워크로드를 위한 성능 및 비용에 따라 최적화된 다양한 옵션을 제공한다. 

옵션은 크게 

- 데이터베이스 및 부트 볼륨을 위한 고성능의 SSD 

- 로그 처리 및 맵리듀스와 같은 처리 성능에 집중한 HDD

> Amazon EBS 일래스틱 볼륨
- 일래스틱 볼륨은 아마존 EBS의 특징 중 하나로 동적인 용량 증대, 성능 튜닝, 성능 저하 없이 기존의 볼륨을 변경할 수 있도록 한다.
- CloudWatch의 성능 지표와 Lambda 함수를 이용해 작업을 간단히 수용할 수 있다.
- 일래스틱 볼륨을 통해 사용자 성능 요구 수준에 맞는 용량 및 성능을 제공할 수 있다.

> Amazon EBS SSD-기반 볼륨
- SSD-기반 볼륨은 다시 범용 SSD와 프로비전 IOPS SSD로 구분된다.
- IOPS SSD(io1)은 전송 지연에 민감한 트랜잭션 워크로드를 처리하기 위한 고 성능에 초점을 맞춘다.
- 범용 SSD(gp2)는 다양한 수준의 트랙잰션 데이터를 처리하기 위한 가격 및 성능의 균형에 초점을 맞추고 있다.
- 블록 스토리지 기기의 성능은 초당 입출력 동작을 뜻하는 IOPS라는 단위로 측정된다.

> 범용 SSD
- 밀리초 단위의 전송 지연만 허용하므로 거의 대부분의 워크로드에 적합하다.
- 100에서 16,000 IOPS 수준의 성능을 내며, 낮은 비용으로 서버 스토리지의 주요 업무 대부분을 처리할 수 있다.
- 1TB 미만의 범용 SSD는 IO 버스트버킷 기능을 사용할 수 있다. 
- 시스템 부트 볼륨, 처리 지연에 민감한 애플리케이션, 가상 데스크톱, 개발 및 테스트 환경 등에서 존재

> 프로비전 IOPS SSD
- IO 성능의 예측가능성 및 일관성이 매우 중요하며, 이런 요구상황에 맞는 볼륨 타입이다.
- 범용 SSD 보다 비용이 높고, 볼륨 크기 및 예약된 IOPS 양에 따라 달라진다.
- Oracle, PostgreSQL, MySQL, Microsoft SQL Server, Mongo DB, Cassandra 등 데이터베이스 워크로드로 사용 할 수 있다.
- 중요한 기업용 애플리케이션, 금융 거래 데이터베이스 등 높은 수준의 IO 성능이 일관되게 요구되는 곳에서 활용된다.

> 아마존 EBS HDD-기반 볼륨
- 입출력 및 처리 성능이 중요한 워크로드를 위한 처리 성능 최적화 HDD
- 낮은 빈도의 입출력 및 저렴한 비용에 초점을 맞춘 콜드 HDD

> 처리 성능 최적화 HDD
- IOPS 대신 스루풋, 즉 처리 성능이 더욱 중요한 성능지표인 워크로드에 적합하다.
- 데이터 웨어하우스, ETL, 로그 프로세싱, 맵리듀스와 같은 작업에 적합하다.
- 순차적인 입출력 워크로드에 적합하며, 급격한 처리 성능 요구에 대응할 수 있는 버스트버킷 모델을 사용할 수 있다.

> 콜드 HDD
- 스루풋 성능에 초점을 맞춘 볼륨 타입이다. 성능이 낮은 편이며 가격도 저렴하다.
- 접근 빈도가 낮은 데이터 처리에 적합하다.

> 스냅샷
- 볼륨 백업을 위한 스냅샷 기능을 제공하며, 사용 중인 볼륨에 대해 언제든 스냅샷을 남겨둘 수 있다.
- 캐시 데이터 등은 스냅샷으로 백업할 수 없으며, S3에 저장되며 용량 제한은 없고, 각 스냅샷 마다 공유의 이름이 부여된다.


###Amazon Elastic File System(EFS)

EC2 인스턴스를 위한 파일시스템 인터페이스 및 파일 시스템 시맨틱 환경을 제공한다.
EC2 인스턴스에 EFS를 부착하면 EFS는 마치 로컬 파일 시스템처럼 작동한다. 
EFS는 공유 파일 시스템으로서 다수의 인스턴스를 위한 공통 파일 시스템 역할을 수행할 수 있으며, 
낮은 전송지연율로 다수의 인스턴스를 지원할 수 있다.

> EFS의 주요 속성

- 완전관리형 : 완전 관리형 서비스로 사용자는 파일 시스템을 위한 하드웨어 또는 소프트웨어를 구매하거나 관리할 필요가 없다.


- 파일 시스템 액세스 시맨틱 : 일반적인 파일 시스템과 동일하며, 읽기 후 쓰기 일관성, 파일 잠금, 계층적 디렉터리 구조, 파일 조작 명령, 세분화된 파일 명칭 부여, 파일 중간의 특정 블록에 쓰기등 어떤 작업이든 가능하다.


- 파일 시스템 인터페이스 : 표준 OS API와 호환성이 유지되는 파일 시스템 인터페이스를 제공한다.


- 공유 파일 시스템 : 수천 개의 인스턴스와 연결될 수 있는 공유 파일 시스템이다.


- 민첩성 및 확장성


- 고가용성 및 고 신뢰성

###온프레미스 스토리지와 AWS 통합하기

데이터 센터에서 클리우드로 대량의 데이터를 전송할 계획이라면 S3에 업로드하는 것만으로는 부족할 수 있다.

10TB 이상의 데이터를 전송해야 히는 경우 AWS와 온프레미스 스토리지를 통합하는 방안을 생각할 필요가 있다. 

대이터 전송을 위한 몇 가지 옵션에 대해 알아보자.

> AWS Storage GateWay

Amazon Storage GateWay(SGW)는 기존 환경에 가상머신 형태로 배포된다. 

이를통해 기존의 애플리케이션, 스토리지시스템, 디바이스를 스토리지에 연결할 수 있다. 

- 파일 / 볼륨 / 테이프 게이트 웨이가 존재한다.

> AWS Snowball

스토리지 디바이스를 이용한 페타바이트 규모의 데이터 이전을 위한 임포트/익스포트 도구다.

기존에는 고객이 직접 데이터 이전을 위한 포터블 스토리지 디바이스를 구입해 데이터를 저장해야 했으나, 

Snowball을 이용하면 높은 보안성, 내충격성의 아마존 전용 NAS 디바이스를 활용할 수 있다. 