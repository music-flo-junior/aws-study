# AWS 공인 솔루션스 아키텍트 올인원 어소시에이트

## 8장. AWS Database


8장에서 다룰 내용은 다음과 같다.

• 관계형 데이터베이스와 Amazon Relational Database Service(RDS)의 개요 
• Amazon Aurora 개요
• Amazon Redshift 이해
• Amazon DynamoDB 이해
• Amazon ElastiCache 개요

### 관계형 데이터베이스의 개요

관계형 데이터베이스에서 정보는 열과 행으로 이뤄진 테이블에 저장되고, 테이블에 저장된 데이터는 공통 키 또는 공통 컨셉에 따라 서로 관계를 유지하며, 
테이블에서 데이터를 인출할 때 이와 같은 관계성을 이용한다는 측면에서 관계형 데이터베이스 라는 이름이 붙었다. 

DBMS 는 데이터의 저장, 관리, 인출 업무를 돕고 관계형 데이터 베이스의 경우 RDBMS가 이와 같은 역할을 대신한다.


> 데이터의 일관성 유지 및 데이터에 대한 접근 가능성을 유지하기 위한 몇 가지 규칙 첫 번째 
 
1. RDBMS 테이블의 행은 서로 명확하게 구분돼야 한다는 것이다. 대부분의 RDBMS 에서 행 복제를 허용하지 않도록 설정 할 수 있다. (unique key, primary key..?)
2. 열의 값 은 그룹 또는 배열 값을 반복해서는 안 된다는 것이다. (왜..?)
3. NULL 값에 대한 것으로 RDBMS에서는 어떤 열의 값을 모를 때 NULL을 사용하며, 이는 해당 데이터에 접근 할 수 없다는 의미이지 값이 없다거나 0이라는 의미는 아니다.

> 기본 키(primary key) 및 외부 참조 키(foreign key)

관계형 데이터 베이스는 기본키 및 외부 참조 키 라는 개념을 사용한다. 

- 기본 키는 테이블에 있는 유일무이한 데이터를 구분하기 위한 것으로 다른 열 과 명확하게 구분될 수 있는 열에 포함된 유일무이한 데이터를 프라이머리 키 또는 기본 키라 부른다.
- 외부 참조 키는 하나의 테이블과 다른 테이블의 관련성을 설명하거나 두 테이블을 연결하는 링크등을 추가할 때 사용한다. 
- 외부 참조 키는 다른 테이블 또는 같은 테이블에서 식별될 수 있는 행을 포함한 필드로 두 번째 테이블에 정의돼 있지만, 첫 번째 테이블의 기본 키 또는 식별 키를 참조해 서로의 관련성을 파악할 수 있도록 한다.

> RDBMS 소프트웨어

널리 사용되는 RDBMS 소프트웨어로는 Oracle, MySQL, PostgreSQL, MariaDB 등 이있다.

### Amazon RDS의 개요

AWS는 관계형 데이터베이스 호스팅 및 관리 서비스인 Amazon Relational Database Service(RDS)를제공하며,다음과 같은 RDBMS 엔진을 사용할 수 있다.

• Aurora MySQL
• Aurora PostgreSQL
• Oracle
• SQLServer
• MySQL
• PostgreSQL
• MariaDB

> 데이터베이스 호스팅 방식

Amazon RDS를 본격적으로 소개하기 전 데이터베이스 호스팅 방식을 알아보자. 

- 전통적인 방식은 온프레미스 데이터 센터에 데이터베이스를 호스팅하는 것이지만 
- AWS에서는 EC2 서버에서 혹은 Amazon RDS에서 관계형 데이터베이스를 호스팅 할 수 있다. 

관계형 데이터베이스를 호스팅하기 위한 주요 시나리오는 다음과 같다.

#### 시나리오1: 온프레미스 데이터 센터에 데이터베이스 호스팅

- 전원 장치 관리, 네트워크 환경 설정, 서버 환경 설정, 운영체제 설치, 스토리지 환경 설정, RDBMS 설치, OS 유지 및 펌웨어 업그레이드, 데이터베이스 소프트웨어 업그레이드, 애플리케이션 최적화 등

사용자의 데이터 센터에 데이터베이스를 호스팅하면 위 작업을 직접 관리해야 한다. 

#### 시나리오2: Amazon EC2 서버에 데이터베이스 호스팅

EC2 서버에 데이터베이스를 호스팅하면 사용자, AWS 가 나눠서 관리하게 된다. 
- AWS가 OS 설치, 서버 유지 보수, 서버 랙 관리, 전원 관리, 냉각 관리, 네트워크 관리 등 업무를 처리한다. 
- 사용자는 OS 관리, RDBMS 설치에 필요한 OS패치 설치, 데이터베이스설치 및 유지보수, 데이터베이스 및 애플리케이션 최적화와 관련된 제반 업무를 맡게 된다.

#### 시나리오3: Amazon RDS를 이용해 데이터베이스 호스팅

Amazon RDS를 이용해 데이터베이스를 호스팅하면 AWS가 데이터베이스 설치부터 OS 패치, 업그레이드 등, 데이터베이스 호스팅과 관련된 모든 복잡한 업무를 대신 처리한다. 
가용성과 확장성 관리 또한 AWS가 맡는다. 
사용자는 애플리케이션 최적화에만 집중하면 된다.

이것이 바로 Amazon RDS가 관리형 데이터 베이스 서비스로 불리는 이유다.

> RDS의 주요 장점

1. 인프라 관리 불필요
2. 즉각적인 프로비저닝
3. 확장성 관리
4. 비욜 효울성
5. 애플리케이션 호환성
6. 고가용성
7. 보안유지

### 데이터베이스 호스팅: Amazon EC2 대 Amazon RDS 비교

Amazon EC2 또는 Amazon RDS 가운데 하나를 선택해서 데이터베이스를 호스팅 해야한다면 우선 두서비스의 차이를 알아야한다.

RDS는 관리형 서비스로 간단하게 사용할 수 있지만, EC2 또는 자체 데이 터 센터에서 데이터베이스를 호스팅하는 경우보다 세부적인 조정이 어려워질 수 있다.
또, AWS가 제반 관리 업무를 대신 처리해주므로 편리하지만 그에 따른 장단점이 생기게 된다. 

> RDS를 추천하는 케이스

• 비즈니스 본연의 가치에 집중하려는 경우

• 데이터베이스 관리 업무를 원치 않는 경우

• 하이레벨튜닝 및 스키마최적화등의 업무만 처리하려는 경우 

• 회사 내 데이터베이스 관리 역량이 충분치 않은 경우

• 푸시 기반 다중 AZ 복제 환경을 이용하는 경우 (오ㅐ..? RDS에 푸시 복제 기능 같은게 활성화 되어 있나? )

• 백업 및 복원 자동화를 원하는 경우

> EC2를 추천하는 케이스

• 데이터베이스 인스턴스에 대한 완전한 통제권을 원하는 경우

• 운영체제 시스템에 대한 통제권을 원하는 경우

• 백업,복제,클러스터링등에 대한 완전한 통제권을 원하는 경우

• 기업의 RDBMS 엔진의 주요기능과 옵션이Amazon RDS와 맞지않는 경우

• 기업에서 요구하는 용량 및 성능이 AmazonRDS의 제공 수준을 넘어서는 경우

### Amazon RDS에서의 고가용성 구현

Amazon RDS는 고가용성 아키텍처를 지원하며, 데이터베이스에 기업의 중요 데이터를 저장하는 경우 HA 환경 설정이 필요하다.

RDS에 적용할 수 있는 다양한 아키텍처 옵션을 알아보자.

> 가장 단순한 아키텍처: 싱글 AZ 배포

개발 환경에서 데이터베이스를 사용하거나 클라우드 기반 데이터베이스에 대한 경험을 얻는 차원에서 사용해 본다면 HA 아키텍처를 고수할 필요는 없다. 
이때는 싱글 AZ 환경에서 Amazon RDS 인스턴스를 론칭하면 된다. 

> 고가용성 아키텍처: 멀티 AZ 배포

기업에게 매우 중요한 데이터베이스를 실행하거나 데이터를 절대 잃어버려서는 안 되는 경우, 
설정된 복원 소요 시간이 매우 촉박하거나 가동 정지 시간이 일절 허용되지 않는 경우, 
멀티 AZ 환경에서 데이터베이스를 배포해야 한다.

멀티 AZ 아키텍처의 경우 마스터 데이터베이스로도 부르는 기본 데이터 베이스가 모든 트래픽을 처리하고, 
스탠바이 데이터베이스는 애플리케이션이 실행 되고 있는 기본 데이터베이스가 섯디운되는 상황을 대비해 가동 가능 상태에서 대기 하게 된다. 

다중 AZ 환경은 기본적으로 동기적 복제 기능을 제공하므로 데이터 손실 기능성이 없다.
또한 RDS는 장애 발생 시 다양한 유형의 대응 방식을 자동으로 적용해, 호스트 인스턴스 섯디운, 스토리지 장애, 기본 인스턴스의 네트워크 연결 단락, AZ 자체 섯다운 등의 장애 상황에 대처할 수 있다.


장애 대응 상황이 발생하면,대기 데이터베이스가 기본 데이터베이스의 역할을 이어 받아서 새로운 기본 데이터베이스로서 모든 애플리케이션의 트래픽을 처리하게 된다.
RDS의 멀티 AZ 아키텍처에서 애플리케이션은 기본 인스턴스와 대기 인스턴스를 맵핑한 DNS 엔드포인트를 이용해 데이터베이스에 연결된다.
따라서 사용자는 장애 대응을 위해 애플리케이션을 새로운 기본 데이터베이스에 연결할 필요가 없다.

(그래서 우리도 db 정보가 dns로 관리되는거군!)

### Amazon RDS에서의 확장성 구현

- 인스턴스 타입 변경
- 읽기 사본 활용

### Amazon RDS에서의 보안성 구현

#### Amazon VPC와 Amazon RDS

Amazon RDS 인스턴스는 Amazon VPC내에서 론칭된다. 
데이터 베이스는 항상 방화벽으로 보호해야 하므로 데이터베이스를 처음부터 프라이빗 서브넷 내에 생성하는 것이 좋다. 

> VPC 내에 실행되는 데이터베이스를 연결하는 방법

• VPC 내에 구현된 데이터 센터를 VPN으로 연결해 하이브리드 방식으로 데이터베이스를 연결할 수 있다.
• Direct Connect로 데이터 센터와 AWS 리전을 연결하면 일관된 성능의 연결 상태를 유지할 수 있다.
• 두개의 VPC를 피어방식으로 연결한 뒤, 하나의 VPC에는 애플리케이션을두고, 다른 VPC에는 데이터베이스를 두고 서로를 연결할 수 있다.
• VPC에 Internet gateway를 부착하고, 이를통해 데이터베이스에 대한 퍼블릭 접근을 허용할 수 있다.
• VPC에 부착한 서브넷의 리우트 테이블을 이용해 VPC의 라우팅 방식을 정의 할 수 있다.

#### Amazon RDS 에서의 데이터 암호화

RDS는 저장 상태의 데이터에 대한 암호화를 제공한다. 
RDS의 암호화된 인스턴스는 데이터 보안을 위한 추가적인 레이어를 제공해 비인가 접근을 차단한다.
Amazon RDS 암호화는 클라우드에 배포된 애플리케이션의 데이터 보안수준을 높이며, 저장 상태 데이터의 암호화 법규에 대한 준수 의무를 효과적으로 지킬 수 있다.
AWS RDS의 데이터베이스 암호화에는 다음 항목에 대한 암호화가 포함된다.

• 데이터베이스 인스턴스 스토리지 암호화
• 자동화 된 백업 암호화
• 마스터 데이터 베이스의 읽기 사본 암호화
• 마스터 데이터 베이스의 스탠바이 데이터베이스 암호화 
• 데이터베이스로 생성한 스냅샷 암호화

> 암호화 처리 방법

Amazon RDS 인스턴스의 데이터 암호화에는 산업 표준인 AES 256 암호화 알고리즘이 사용되며, 일단 데이터 암호화를 진행한 뒤 RDS는 자동으로 복호화 과정을 처리한다. 
RDS 인스턴스를 생성하고 암호화 기능을 활성화하면, AWS KMS 내에 RDS를 위한 기본 키가 생성돼 Amazon RDS 인스턴스의 데이터 암호화 및 복호화에 사용할 수 있고 사용자는 자신의 계정을 통해 키를 관리할 수 있다.    

데이터 암호화에 사용되는 키는 두 개의 계층 구조를 지닌다. 
• RDS 데이터 키 : RDS내 데이터 암호화
• AWS KMS 마스터 키 : 데이터 키 암호화

### 백업, 복구, 스냅샷

Amazon Aurora(MySQL 및 PostgreSQL)을 제외한 모든 Amazon RDS 엔진은 하루 한 번의 백업을 실행한다. 

백업으로부터 데이터베이스를 복원하는 경우 기존 데이터베이스와 완전히 동일한 새 복사본을 생성하거나 기존 데이터베이스를 복제할 수 있다. 

스냅샷은 데이터베이스 백업의 또 다른 방법으로 자동으로 일정 관리를 할 수 없으며, 사용자가 직접 스냅샷을 생성해야 한다.

### 모니터링

아마존은 RDS에서 실행되는 데이터베이스를 모니터링할 수 있는 다양한 방법을 제공한다. 
기본 모니터링 방법은 표준 모니터링이며 필요에 따라 좀 더 기능이 세분화된 모니터링을 사용할 수 있다. 

RDS는 모니터링된 모든 성능 지표를 Amazon CloudWatch로 전송하고 사용자는 이를 RDS 콘솔, CloudWatch 콘솔 또는 CloudWatch API를 통해 확인할 수 있다.

> 이벤트 노티피케이선

RDS 인스턴스에서 발생하는 이벤트를 신속하게 확인할 수 있는 옵션으로 RDS에 어떤 변화가 생기면 Amazon SNS를 통해 노티피케이션을 전송한다.

> 퍼포먼스 인사이트

Amazon RDS의 모니터링 기능을 확장한 것으로 데이터베이스의 성능을 시각화해 성능에 영향을 미치는 요소를 분석하는 데 도움을 준다.

### Amazon Aurora

Amazon Aurora는 클리우드에 최적화된 MySQL및 PostgreSQL 호환 관계형 데이터베이스다. 
상용 데이터 베이스로서의 성능 및 가용성을 제공하고, 오픈소스 데이터 베이스로서의 간소함과 비용효율성을 제공한다.
Amazon Aurora는 완전 분산형 및 자가 진단형 스토리지 시스템을 통해 성능 및 신뢰성을 보장하고, 탄력성 및 AWS 클라우드 관리 역량을 바탕으로 한 가용성을 제공한다.

Aurora는 세개의 서로 다른 AZ에 있는 여섯 개의 서로 다른 스토리지 노드로 분리된 스토리지 레이어에 자동으로 데이터를 복제하는데 이는 별도의 비용 없이 데이터를 여섯 번 미러링 한다는 측면에서 의미가 크다. 
이와 같은 모든 데이터 미러링은 동기적으로 진행되므로 데이터 손실이 발생하지 않는다.

또,Amazon Aurora는 멀티 스토리지 노드에서의 데이터 가용성을 보장하기 위해 읽기 및 쓰기를 위한 쿼럼시스템을 사용한다. 
동시에 모든 데이터는 S3에 지속적으로 백업돼 신뢰성 및 가용성을 제공한다.

Amazon Aurora 사용시 스토리지 볼륨은 자동으로 64TB로 증가한다.

Aurora MySQL 데이터베이스의 성능은 일반적인 MySQL 엔진의 평균 다섯 배에 이르는 성능을 보여준다.

### Amazon Redshift

Amazon Redshift는 관리형 데이터 웨어히우스 솔루션으로 비즈니스 인텔리전스 활동에 맞게 설계되며, 기업 조직에서 요구히는 데이터 처리 및 분석 성능을 강화하는데 주로 사용된다. 

> Amazon Redshift의 장점

1. 신속성
2. 저렴함
3. 우수한 압축성
4. 관리형 서비스
5. 확장성
6. 보안성
7. 존 맵 기능

> Amazon Redshift의 아키텍처

Amazon Redshift 아키텍처는 리더 노드와 컴퓨트 노드로 구성된다. 
클러스터마다 하나의 리더 노드가 존재하며, 컴퓨트 노드는 여러 개가 존재할 수 있다.

### Amazon DynamoDB

Amazon DynamoDB는 확장성 및 개발의 신속성을 제공하는 고성능의 완전 관리 형 No SQL 데이터베이스다.
No SQL이라는 이름은 고성능의 비관계형 데이터베이스 임을 나타내며, 그래프, 키 밸류 쌍, JSON 문서 등 다양한 데이터 모델을 사용한다. 
No SQL은 쉬운 개발, 고확장성, 고가용성, 고신뢰성을 제공하는 데이터베이스다.

DynamoDB는 완전 관리형 클라우드 NoSQL 데이터베이스 서비스로 테이블 생성, 목표 처리 성능 설정, 저장 상태의 데이터 관리 등을 지원한다. 
사용자는 테이블 생성 시 애플리케이션에 요구되는 처리 용량만 지정하면 된다.
또 처리 성능의 요구 수준이 변경되면, AWS 관리콘솔 또는 DynamoDB API를 이용해 테이블의 요청 처리량을 업데이트하면 된다. 
DynamoDB는 확장성을 자동으로 관리하므로 애플리케이션에 대한 처리 성능 요구 수준이 높아지기 전에 스케일업 할 수 있다.

> Amazon DynamoDB의 장점

1. 확장성
2. 관리형 서비스
3. 신속성, 일관된 성능
4. 세분화된 접근 제어
5. 비용 효율성
6. 다른 AWS 서비스와의 통합

### Amazon ElastiCache

Amazon ElastiCache는 클라우드에서 인메모리 캐시를 배포, 운영, 확장하기 위한 웹 서비스로 AWS 리소스 프로비저닝부터 소프트혜어 설치에 이르는 전반적인 인 메모리 서비스 설정 작업을 돕는다. 

사용자는 불과 몇 분만에 ElastiCache의 API 를 이용해 애플리케이션에 인메모리 캐시 레이어를 추가할 수 있다. 

ElastiCache는 Amazon EC2, Amazon RDS는물론AWS CloudFormation, AWS Elastic Beanstalk,AWS OpsWorks 와 통합해 사용할 수 있다.

현재 Amazon ElastiCache는 두 가지 종류의 인메모리 키 밸류 엔진을 지원하며, 사용자는 자신의 필요에 따라 이들 두 엔진 가운데 선택할 수 있다.

- Memcached : 오랜 기간 동안 널리 사용되고 있는 인메모리 키 스토어로서, 웹 캐싱 부문의 표준이라 부를 만하다. 
- Redis : 최근 많은 인기를 얻고 있는 오픈소스 키 밸류 스토어로 정렬세트, 해시, 리스트 등 더 많은 고급 데이터 구조를 지원한다.

### Amazon Neptune

Amazon Neptune은 완전 관리형 그래프 데이터베이스 서비스로 수십억 개의 노드와 관련성을 지닌 그래프 구조 데이터의 저장 및 쿼리에 사용된다. 
Amazon Neptune을 이용해 고도의 연결성을 지닌 그래프 데이터세트를 생성, 저장, 쿼리할 수 있다.

### Amazon DocumentDB

Amazon DocumentDB는 MongoDB 워크로드 처리를 지원하는 완전 관리형 데이터베이스서비스로 JSON 데이터의 저장,쿼리,인덱스 작업을 수행할 수 있다. 
Document DB는 MongoDB와 호환되므로 이미 MongoDB를 사용하고 있는 수많은 애플리케이션, 드라이버, 각종 도구를 별다른 변환 작업 없이 바로 사용할 수 있다. 
개발자는 Amazon DocumentDB 환경에서 기존 MongoDB의 애플리케이션 코드, 드라이버, 각종 도구를 그대로 이용해 워크로드 처리를 위한 데이터베이스 실행, 관리, 확장 업무를 수행할 수 있다.
