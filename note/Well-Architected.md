# AWS 공인 솔루션스 아키텍트 올인원 어소시에이트

## 9장. AWS Well-Architected Framework

9장에서 살펴볼 내용은 다음과 같다.
• 클라우드 환경에서의 보안 유지 방법
• 신뢰할 수 있는 클라우드 아키텍처 구현 방법
• 클라우드 아키텍처의 성능을 높이는 방법
• 클라우드 아키텍처의 비용 효율성을 놈이는 방법 
• 클라우드 아키텍처의 운영 성과를 높이는 방법

### Well-Architected Framework 원칙 장점

클라우드 아키텍처 구현 시 AWS의 Well-Architected Framework 원칙(이하 WAF) 은 다음과 같은 장점을 제공한다.

1. 신속한 개발과 배포
: 개발자의 시스템 운영과 관련된 위험 관리 업무는 줄어들고, 업무의 자동화 및 적재적소에 맞는 용량 관리를 통해서 클라우드의 효용성을 중대시킬 수 있다.

2. 위험의 감소
: 아키텍처에 존재하는 위험을 구체적으로 파악하고 비즈니스 또는 개발 팀에 미칠 부정적인 영향을 최소화할 수 있다.

3. 정보 기반의 의사결정
: 최고의 비즈니스 성과를 거두기 위한 능동적인 아키텍처 구현을 위한 의사결정을 내릴 수 있다.

4. 최선의 AWS 활용 전략
: AWS WAF 전략을 이해함으로써 오랜 기간동안 다수의 기업 및 사용자에 의해 검증된 최선의 AWS 활용 전략을 팀 및 조직에 적용할 수 있다.

AWS에서 아키텍처를 설계하려면 토대부터 단단히 다져야 하며, 이는 AWS의 WAF 원칙을 기반으로 아키텍처를 설계해야 함을 의미한다.
AWS의 WAF 원칙은 오랜 시간, 다수의 기업에 의해 검증된 AWS 활용의 베스트 프랙틱스를 아키텍처에 반영하는 방법이다.

> AWS WAF 다섯 가지 원칙
1. 운영 우수성 원칙
2. 보안성 원칙
3. 성능 원칙
4. 신뢰성 원칙
5. 비용 최적화 원칙

### 운영 우수성 원칙

운영 우수성은 시스템이 비즈니스를 얼마나 잘 지원하고 있는지를 측정한 것이며 운영 팀이 비즈니스 SLA를 준수하기 위해 노력하고 있다면 이미 좋은 출발을 한 것으로 평가할 수 있다.
시스템이 비즈니스 목적의 달성을 지원하려면 먼저 운영 팀이 기업의 비즈니스 목표, 우선 순위, 주요 성과 지표를 잘 이해하고 있어야 한다.

운영 팀은 비즈니스 목적상 중요한 애플리케이션과 그렇지 않은 애플리케이션의 우선 순위를 매긴 뒤 우선 순위에 따라 지원 수준을 결정해야 한다.

클라우드에서의 운영 우수성 원칙을 달성하기 위한 세부 실천 사항은 다음과 같다.

1. 운영 업무의 코드화 
- 클라우드에서는 전체 인프라를 코드로 표현할 수 있고 코드 단위로 업데이트하는 것이 가능하다. 
- 모든 운영 업무는 스크립트로 작성할 수 있고 가능한 많은 부분을 코드로 자동화 할 수 있도록 한다.

2. 운영 업무의 문서화 

3. 지속적인 작은 변화의 실천
- 시스템에 한 번에 큰 변화를 주기보다 시스템을 개선할 수 있는 수정 가능한 작은 변화를 지속적으로 추구하는 것이 중요하다.

4. 운영 절차의 지속적 개선
- 아키텍처는 지속적으로 진화하고 있으며 운영 절차 또한 지속적으로 업데이트해야 한다.

5. 실패 상황 고려
- 운영 팀이라면 누구도 실패 상황이 발생할 때까지 기다려서는 안되며 특정 시점에서의 실패 가능성을 미리 고려하고 능동적으로 실패 시나리오를 시뮬레이션해야 한다.
  ( 카나리 배포하고 scale in/out 체크했던게..이런거 아닐까?)

6. 운영 실패 사례를 통한 학습
- 운영 팀은 항상 운영 실패 사례에서 교휸을 얻고 동일한 실패 상황이 재발하지 않도록 해야 한다.

> 운영 팀 대시보드에 필요한 네 가지 서비스

1. Amazon CloudWatch logs : EC2 인스턴스, AWS CloudTrail, 다른 리소스의 로그를 모니터링하고 저장한다.
2. Amazon ES : 로그 분석, 애플리케이션 모니터링을 위한 Elasticsearch의 배포, 보안, 운영, 확장을 지원한다.
3. Personal Health Dashboard : 사용자 개인에게 영향을 미칠 수 있는 이벤트에 대한 경고, 대응 가이드를 제공한다.
4. Service Health Dashboard : AWS 서비스의 가용성과 관련된 주요 정보를 1분 단위로 제공한다.

### 보안성 원칙

보안은 가장 중요한 요소라 할 수 있고 어느 기업에서나 최우선순위 업무로 다뤄져야 한다.

1. 강력한 접근 관리 전략 수립
- AWS에서는 IAM으로 계정을 관리하며, IAM 활용의 기본 원칙은 최소 권한 부여 및 필요한 만큼의 권한 부여로 요약할 수 있다.
- IAM 유저 또는 페더레이션 유저 기능을 활용한다.
> AWS의 아이덴티티 페더레이션 : SAML 2.0 또는 웹 신분 증명을 통해 사용할 수 있으며, 연합 신분 증명 방식인 페더레이션을 이용하면 다른 기관에서 발급한 ID를 IAM의 신분 및 권한 증명에 그대로 이용할 수 있다.
- 강력한 패스워드 정책을 수립해 패스워드 생성시 대소문자, 특수기호 등의 조합을 사용하고 일정 시간 경과 후엔 패스워드를 변경하고, 변경 시에는 최근 사용한 10개의 패스워드는 다시 사용할 수 없도록 하는 것이 좋다.

2. 추적 기능 활용
- 시스템에서 벌어지는 모든 일을 실시간으로 추적, 감사, 모니터링, 로그 데이터로 기록할 수 있어야 하며, 변경 사항 발생 시 경고 메시지를 받을 수 있는 체계를 갖춰야 한다.
- AWS Config를 이용해 AWS 리소스 인벤토리, 환경 설정 내 역의 추적을 및 거버넌스를 위한 환경 설정 변경 알림 업무를 수행할 수 있다. 또 적절한 승인이 없는 경우 시스템 내에서 어떠한 변경도 이뤄질 수 없도록 해야한다.

3. 모든 레이어에 대한 보안
- 보안은 리소스의 전 스택에 걸쳐 모든 레이어에 적용돼야 한다.
- 예를 들어, 프라이빗 서브넷과 퍼블릭 서브넷에서 EC2 서버를 실행하고 있는 경우 NACL을 통한 서브넷 레이어보안,EC2 레이어보안,시큐리티그룹을 통한 로드밸런서 레이어 보안을 통해 운영체제, 스토리지 그리고 여기서 실행되는 애플리케이션을 완벽하게 보호해야 한다.
- 즉, 모든 인프라 요소를 격리 상태로 유지하고 각 요소별 보안을 유지해야 한다.
- 방화벽 또한 모든 레이어에 적용해야 하며, 웹 티어, 앱 티어, 데이터베이스 티어 모두에게 각각 방화벽을 적용하고 각 티어마다 서로 다른 ACL을 적용해야 한다.
- AWS는 보안 책임과 관련해 공유 책임 모델을 통해 클라우드 운용에 따른 데이터 센터, 물리적 시설 네트워킹 인프라에 대한 보안 책임을 분담한다. (VPC를 생성해서 관리.)

4. 데이터 보안
- 저장 상태 및 전송 상태에 있는 데이터 보안 모두 중요하며 데이터의 중요도, 민감도에 따라 적합한 수준의 암호화 기술을 적용해야 한다. 
- 전송 상태 데이터는 SSL또는 TLS기법 으로 데이터를 암호화할 수 있다.
- 전송 상태 데이터의 경우,VPN 또는 Direct Connect를 이용해 데이터를 암호화 할 수있고, 대기 상태 데이터의 경우, TDE 기술을 활용해 데이터를 암호화할 수 있다.
- 암호화 키 사용 시 AWS KMSKey Management Service를 이용해 키 생성 및 관리 업무를 수행할 수 있다.
- Amazon CloudFront는 커스텀 도메인 네임 생성 및 관리는 물론 SSL 인증서, SNI 기반 커스텀 SSL, 전용 IP 커스텀 SSL 기능을 제공한다.

5. 보안 자동화
- 보안 관련 이벤트 발생시 자동으로 실행되는 보안 환경을 구성하고 보안 위협 가능성을 항상 확인 하기 위한 모니터링 및 로그 리포트 체계를 갖춘다.
- 보안 유지를 위한 실천 방안으로서 자동화를 구현하는 것은 매우 중요하며, 보안 위험 및 오류를 최소화하는 데 보안 업무 자동화는 많은 도움을 준다. 

6. 보안 위협에 대한 대응
- 보안 위협 이벤트가 발생 하기 전 능동적으로 보안 위협 상황을 시뮬레이션해 실제 상황에 대비할 수 있으며, 실제와 같은 해킹 시도 등을 재현해 현 보안 시스템의 피해 가능 내역을 확인할 수 있다. 

### 성능 원칙

성능은 결국 속도에 대한 것이며 성능 효율성을 통해 비즈니스 성과를 향상시키는 것이 목표다.

성능 원칙을 위한 설계 원칙은 다음과 같다.

- 간단한 조작으로 글로벌화 달성 : AWS를 이용해서 불과 수 분만에 글로벌 인프라를 준비할 수 있다. (멀티 AZ 활용을 고려.)
- 서버리스 등 신기술 활용 : 비즈니스 운영에 사용되는 서버를 기업이 직접 관리할 필요가 없다는 것이다. 서버리스 아키텍처를 최대한 활용하는 것이 좋다
- 최신 고급 기술 활용 : 클라우드에서는 최신의 고급 기술을 활용하기 위해 관리형 서비스를 이용하면 된다.
- 다수의 기술 활용 : 다양한 서비스를 통한 업무 부하 감소 수준이 얼마나 되는 지 파악하여 활용한다.
- 잦은 실험과 혁신 노력

> 성능 효율성

선택, 검토, 모니터링 3단계로 구성된다.

#### 1단계 : 선택

1. 컴퓨트
- 컴퓨팅 자원은 인스턴스, 컨테이너, 함수 등 세 가지 형태로 제공된다.
- 인스턴스는 가상화된 서버(EC2) 로서 몇 번의 클릭 또는 API 호출을 통해 여러 가지 설정 내용을 변경할 수 있다. 
- 컨테이너는 애플리케이션 실행을 위한 OS 가상화 기법 중 하나로 리소스와 격리된 실행 의존 요소를 제공한다. 
- AWS Lambda 함수는 별도의 인스턴스 없이 코드를 실행할 수 있는 서비스다. 

2. 스토리지
- AWS의 스토리지는 다양하며, 사용자는 다양한 스토리지를 경험하며 기업니즈에 맞는 것을 찾는 것이 좋다.
- 이상적인 스토리지 선택을 위해 데이터 접근 방식 (블록, 파일, 객체), 데이터 접근 패턴(임의형, 연속형), 데이터 접속 빈도(온라인, 오프라인, 아카이브), 데이터 업데이트 주기(WORM, 동적 갱신), 데이터 요구 처리 성능, 가용성 및 신뢰성 수준 등을 고려해야 한다. 

3. 네트워크
- 특정시스템을 위한 최적의 네트워크 솔루션은 지연 시간, 요구 처리 성능 등에 따라 달라지며, 사용자의 위치, 온프레미스 리소스의 위치 등 물리적 제약 사항은 최신의 네트워크 엣지 및 리소스 배분 기술로 해소할 수 있다. 

4. 데이터베이스
- 관계형 데이터베이스에 데이터를 저장하려면 EC2 서버와 RDS 를 이용할 수 있고, NoSQL 같은 비관계형 데이터베이스로 DynamoDB를 사용할수 있으며, 데이터웨어 하우스 서비스로 Redshift를 이용할 수 있다.
- 최근 검색 기술은 눈에 띄게 발전을 거듭했으며, Elasticsearch와 Kibana를 이용해 검색 기능을 구현하고 LogStash를 이용해 도큐먼트 및 로그를 집약해 관리할 수 있다.

### 신뢰성 원칙

신뢰성은 서비스 수준 계약서(SLA) 상의 요구 사항을 준수할 수 있는 아키텍처를 설계하기 위한 신뢰성을 의미하며, 다양한 실패 상황에서 복구를 위한 방법과 비즈니스 유닛이 감당할 수 있는 리소스 고갈 수준 파악, RTO 및 RPO 레벨에서의 업무 정상화 방법 등이 포함된다.

클라우드에서 신뢰성의 원칙을 구현하기 위한 다섯 가지의 세부 원칙이 있다.

1. 복원 절차 검증
2. 실패 복원의 자동화
3. 리소스의 수평적 확장
4. 요구 성능 및 용량 구체화
5. 시스템 변경 업무의 자동화

> 애플리케이션의 가용성 설계 시 고려해야 할 사항

- 장애 격리 지역 활용 : AWS는 AZ에 장애격리를 위한 전용구조를 제공하며,이와 같은 장애 격리는 리전당 두 개 이상 마련돼 있다. 
- 중복 구현 요소 활용 : AWS의 설계원칙 중 하나는 물리 인프라에서 단일실패지점을 만들지 않는다는 것이다. AWS의 모든 물리 인프라는 중복 구현 원칙을 따르고 있으므로 애플리케이션을 설계할 때도 이와 같은 중복 구현 요소를 잘 활용해야 한다. 

> 변경 대응 관리

시스템 전체가 내려갈 수 있으니, 변경 대응 관리는 이러한 상황에 대한 대응 방안에 대한 것이다.
시스템에 변경 사항 적용시 다음과 같은 배포 패턴으로 리스크를 최소화 할 수 있다.

- 블루 그린 배포 
: 두개의 배포 스택이 병렬적으로 실행되며, 하나의 스택은 구 버전에서 또 다른 스택은 새버전에서 함께 실행된다. 새 배포 스택에는 약간의 트래픽만을 흘려보내서 실패, 오류 가능성을 파악하고 나머지 트래픽은 구 버전 스택에 보내는 방식이다(새 버전 10%, 구 버전 90% 비중 ).
  새 버전의 스택에서 실패 상황이 발생하면 10 % 의 트래픽도 구 버전으로 보낸 뒤 문제를 해결하면 된다. 상황이 개선되면 새 스택으로 트래픽을 점진적으로 보내다가 최종적으로 100%를 처리하도록 한다.

- 카나리 배포
: 고객 중 일부를 새 버전으로 라우팅해 변경 또는 오류 가능성을 검증하는 방식이다. (전체가 아니라 일부인 점이 블루 그린 배포와 차이.)

- 기능별 활성화
: 고객이 필요 기능으로 인지 하지 못하는 기능을 비 활성화 한채로 배포하는 방식으로 배포판에 별 문제가 발생하지 않으면 해당 기능을 활성화 한다. 
배포판에서 문제가 확인된 경우 디음 배포까지 해당 기능을 비활성화한 채로 두면 된다. (..?)

> 장애 대응 관리

발생 가능 장애 시나리오를 통해 모든 실패 상황에 미리 대비할 수 있으며 이에 맞춰 시나리오별 백업 및 DR, 즉 장애복구 전략을 수립한다.

### 비용 최적화 원칙

비용 최적화 원칙은 미사용 리소스 및 비효율 리소스의 제거를 통해 비용을 절감하기 위한 전략을 담고 있다. 

비용 최적회를 위한 세부 원칙은 다음과 같다.

1. 최적의 소비 모델 선택
- 클라우드의 대표적인 소비모델은 온디맨드 및 종량제 가격 모델이며, 사용자는 이를 통해 사용하지 않는 리소스를 언제든 섯다운할 수 있다. 
- 애플리케이션의 연간 트래픽 상황을 파악하고 있다면 비수기에 인스턴스 중 일부를 섯다운해 비용을 절감할 수 있다.

2. 관리형 서비스 사용
- 인프라 보유 부담을 줄이고 관련 비용 또한 대폭 절감할 수 있다.

3. 전박적인 효율성 측정

4. 비용 분석
- 비즈니스 유닛별 비용 분석 도구를 활용해 시스템운영과 관련된 비용을 확인하고 이를 사업부 책임자에게 효과적으로 전달할 수 있다.

5. 전통적인 데이터 센터 투자 감축
- AWS의 다양한 클라우드 서비스는 전통적인 데이터 센터의 소유 및 운영 필요성을 줄여준다.


> 클라우드 베스트 프랙티스

• 실패를 대비한 설계

• 모든 레이어에 보안성 구현 

• 다중 스토리지 옵션 활용

• 탄력성 구현

• 병렬 처리 기법 활용

• 느슨하게 연결된 아키텍처

