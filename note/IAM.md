# AWS 공인 솔루션스 아키텍트 올인원 어소시에이트

## 5장. AWS IAM - 신분 및 권한 관리

### 신분 인증

신분 인증(Authentication)이란 리소스에 접근하려는 상대가 누구인지 밝히기 위한 체계로, IAM의 신분 인증과 관련된 주요 기능은 다음과 같다.

> 유저 및 접근 권한 관리

클라우드 유저를 생성하고 액세스 키, 패스워드, 멀티 팩터 인증 등 보안 수단을 관리할 수 있다. 또 유저의 접근 허용 관리, 유저가 수행할 수 있는 작업의 세부적인 통제가 가능하다.

> 그룹화된 유저 및 접근 권한 관리

협업을 위해 그룹화된 유저를 관리할 수 있다. 간단히 말해 리소스 접근에 앞서 제3자로 부터 신분을 확인 받는 것이다.

그룹화를 이용해서 AWS 리소스에 접근할 수 있는 싱글 사인온 방식으로 기업 디렉터리에 접근할 수 있다.

AWS는 인증 정보 제공자(IdP)와 애플리케이션이 신분 인증 및 보안 정보를 교환할 수 있도록 보안 추가 마크업 언어인 SAML 방식을 지원하고, 마이크로소프트 액티브 디렉터리를 위한 AWS 디렉터리 서비스등 비 SAML 방식도 지원한다. 

IdP를 이용하면 사용자 신분 정보를 관리하거나 커스텀 로그인 코드를 작성할 필요가 없다. 

기업 고객 등 외부 사용자는 아마존, 구글, 페이스북등 널리 알려진 인증 정보 제공자를 통해서 로그인하고, 여러분은 이들 사용자가 AWS 리소스에 대한 접근할 수 있도록 승인하면 된다.

### 권한 부여

IAM은 사용자에게 필요한 권한을 부여해 주는 체계로 이를 이용해 클라우드 내에서 사용자의 행동을 세부적으로 관리할 수 있다.

IAM은 AWS의 모든 서비스에 적용되고 있으며, EC2 인스턴스용 데이터베이스 설정과 같은 작업을 하는 경우 어떤 사용자가 해당 리소스에 접속해서 어떤 일을 할지에 대한 규칙을 생성할 수 있게 해준다.

이를 통해 '최소한의 권한 부여 및 책임의 분리' 라는 보안 컨셉을 구현할 수 있다.

AWS에서는 IAM 정책이라는 방식으로 권한을 부여한다. IAM 정책은 JSON으로 작성된 하나 혹은 그 이상의 접근 승인 규칙을 담고 있다.

승인 규칙은 특정 IAM 엔티티가 어떤 리소스에 대해 어떤 작업을 수행할 수 있는지 정의한다. 이렇게 작성된 정책은 유저, 그룹, 롤 등 어떤 IAM 엔티티에도 적용이 가능하고, 유저 또는 그룹이 할 수 있는 행동, 접근 가능한 리소스의 종류, 실행 결과 등 클라우드에서 일어나는 거의 모든 권한 부여 업무를 정의할 수 있다.

정책을 이용하면 IAM 엔티티를 위한 어떤 형태의 리소스에 대해서도 접근 허용 또는 거부 규칙을 추가할 수 있다. IAM 유저를 생성하면 모든 리소스의 접근에 대한 기본 설정은 거부이며, 특정 리소스에 대해 명시적으로 허용 여부 표시해 줘야 한다.
즉, 기본적으로 접근 승인 여부는 거부로 설정돼 있으며, 명시적으로 접근 허용을 하지 않는 한 어떤 IAM 엔티티도 여러분의 클라우드 리소스에 접근할 수 없다.

### 감사

AWS는 클라우드 업무 감사를 위한 도구를 제공한다. 여기서 감사 업무란 기업에 제정한 규칙과 국가 등이 정한 법규등의 준수 여부를 확인하고 증빙하는 작업이다.
여기에는 기업 중요 자원에 대해 적정한 권한이 있는 사람이 규칙 및 규정에 맞게 접근을 요청하고 작업을 진행했는지 확인하는 일도 포함된다.

AWS CloudTrail은 계정에서 일어나는 일을 기록하고 이에 대한 로그 파일을 Amazon S3 버킷에 저장한다. 
CloudTrail은 API 호출 및 그에 따라 발생한 이벤트 등 계정에서 일어난 일을 기록해 클라우드에서 유저의 행동을 관찰할 수 있게 해준다.

CloudTrail이 기록한 정보는 리소스에 대한 변동 사항을 확인할 수 있게 해주고, 운영상의 문제를 해결할 수 있게 돕는다.
CloudTrail은 클라우드 리소스에 대한 기업 내부 정책 및 표준 규정이 준수될 수 있도록 한다.

### 보안 자격 정보의 유형

AWS 생태계에서는 다양한 유형의 보안 자격 정보(Security Credentials)가 사용되며, 보안 자격 정보는 사용자가 어떤 방식으로 AWS 리소스에 접근하는지에 따라 달라진다.

예를 들어, AWS 콘솔을 통해 로그인하는 경우 유저네임과 패스워드를 사용하지만, Amazon EC2 환경에서 로그인하는 경우 키 페어를 사용한다.

앞으로 자주 사용하게 될 보안 자격 증명은 다음과 같다.

1. IAM 유저네임과 패스워드 : AWS 매니지먼트 콘솔 로그인 시 주로 사용
2. E-mail 주소와 패스워드 : 루트 계정과 연동
3. 액세스 키 : CLI, API, SDK 활용 시 주로 사용
4. 키 페어 : Amazon EC2 서버 로그인 시 사용
5. 멀티 팩터 인증 : 루트 계정 로그인 시 추가 보안 인증 수단으로 활용

### 임시 보안 자격 정보

AWS는 위의 보안 자격 정보 외에도 임시 보안 자격 정보를 제공한다. 이는 단기간만 사용할 목적으로 활용되고, 수 분에서 수 시간만 보안 자격으로서의 유효성이 유지된다. 유효 기간이 만료되면 임시 보안 자격 정보는 더 이상 사용할 수 없다. API 를 통해 임시 보안 자격 정보를 사용할 때 유효 기간이 만료되면 AWS는 해당 API를 인식할 수 없게 된다.

파트너 개발자 등 신뢰할 수 있는 다른 유저에게 AWS 리소스에 대한 접근 권한을 부여하기 위해 임시 보안 자격 정보를 제공하는 경우에는 AWS 시큐리티 토큰 서비스를 사용할 수 있다. 이 토큰은 유저 측에 저장되지 않으며, 유저가 요청할 때마다 동적으로 생성된다.

### 유저

IAM에서 유저란, AWS 생태계에 존재하는 사용자 또는 서비스를 가리키는 유일무이한 개체다. 사용자는 개체를 통해 AWS와 상호작용하고 일상의 업무를 수행한다.

IAM 유저는 유저네임과 보안 자격 정보를 지닌다. 유저를 처음 생성하면, 어드민 등이 명시적으로 접근 권한을 승인해주지 않는 한 아무런 리소스에도 접근할 수 없다.

AWS는 본인을 비롯해 다수의 관리자급 사용자를 위해서 우선 몇 개의 유저 개체를 생성하고 이들에게 어드민 권한을 부여하는 방법을 권장한다. 이렇게 생성된 유저에 대해서는 그들의 실제 업무에 맞게 권한을 세부적으로 부여하거나 박탈할 수 있다. 

예를 들어, 특정 개발자에게 웹 서버에 대한 접근 권한만 부여하려는 경우 어드민은 해당 유저에게 특정 EC2 서버에 대한 접근만 승인하면 된다.
또 특정 개발자가 데이터베이스 작업을 해야하는 경우, 어드민은 RDS에 대한 리드 온리 권한만 부여할 수 있다. IAM으로 처음 생성된 유저는 보안 자격 증명 또한 지니고 있지 않으므로, 어드민은 이들 유저에게 적합한 보안 자격 증명을 부여해야 한다.

IAM을 통한 유저 생성 방법은 다음과 같다.

1. IAM에서 유저 생성
2. 유저에 보안 자격 증명 부여
3. 유저에 접근 승인, 역할, 책임 부여
4. 유저를 하나 혹은 다수의 그룹에 추가

> 루트 계정

AWS 계정을 처음 생성하면 AWS 루트 계정을 보유하게 되는데 이는 AWS 리소스에 대한 무제한의 접근 권한을 의미한다. 루트 계정은 유닉스 시스템에서의 슈퍼유저 계정이라 할 수 있으며, 슈퍼유저는 해당 시스템에서 모든 권한을 지닌다.

### 그룹

IAM 그룹은 유닉스 운영체제의 그룹과 유사한 개념이다. 예를 들어, 회사에 50명의 개발자가 있고, 개발자 모두에게 비슷한 권한과 책임을 부여하고 있으며, 서비스 개발에 필요한 역할과 권한이 20가지로 세분화돼 있다고 하자. 

그럼 이를 기준으로 그룹을 먼저 생성하고, 새로운 개발자가 입사하면 그룹에 추가하는 방식으로 역할과 권한을 부여하는 업무를 단순화할 수 있다.

IAM 그룹의 특징은 다음과 같다.

1. 그룹은 다수의 역할과 권한으로 구성되고 IAM을 이용해 승인
2. 그룹에 추가된 유저는 그룹에 정의된 역할과 권한을 상속
3. 그룹에 다수의 유저 추가 가능
4. 하나의 유저가 다수의 그룹에 포함될 수 있음
5. 단, 하나의 그룹을 다른 그룹에 추가할 수 없고 그룹에는 오직 유저만 추가 가능
6. AWS 계정의 모든 유저를 포함한 기본 그룹이 자동으로 생성되지 않으며, 그룹을 생성해서 모든 유저를 추가할 수 있음

### 롤

AWS 사용자는 두 개의 타입이 있다.

하나는 AWS 환경에서 영구적인 신분을 보유한 IAM 유저, 다른 하나는 영구적인 신분을 보유하지 않는 IAM 그룹이다.

IAM 유저는 접근 승인과 연결된 영구적인 신분을 보유하고 있으므로 해당 승인 내용과 관련된 모든 업무를 처리할 수 있다. 반면 IAM 그룹은 영구적인 신분을 보유하지 않으므로 역할 즉, 롤을 생성해 승인권을 관리하게 된다.
물론 IAM 유저에게도 롤을 추가할 수 있다.

IAM 롤을 이용하면 유저 또는 서비스가 필요로 하는 리소스에 일련의 접근 승인 규칙을 추가할 수 있다. 예를 들어, 롤을 통해 특정 어플리케이션이 S3 버킷에 접근할 수 있도록  승인할 수 있고, 롤을 통해 모바일 애플리케이션 또는 서비스가 실행될 때나 런타임 시 적용된다.

IAM 롤은 AWS 생태계에서 할 수 있는 일과 없는 일을 구분해주는 승인권과 관련된다는 점에서 IAM 유저와 비슷한 부분이 있다.


하지만  롤은 특정 사용자에게만 국한되지 않고, 어떤 사용자에게든 적용될 수 있다는 점에서 차이가 있다.

롤에는 보안 승인 정보가 없으므로 유저가 롤을 할당 받았을 때 또는 애플리케이션에 롤이 적용될 때 AWS에 의해 동적으로 생성돼 해당 유저 또는 애플리케이션에게 적용된다.
이렇게 하면 사용자는 특정 리소스에 접근하려는 애플리케이션을 위한 장기 보안 승인 정보를 공유할 필요가 없어진다. 따라서 IAM 롤은 AWS 서비스의 요청 수행을 위한 일련의 승인 규칙을 정의하는 개체라고 할 수 있다.

IAM 롤의 주요 활용 방식은 아래와 같다.

- AWS 리소스에 접근하지 않는 유저, 애플리케이션, 서비스의 접근대행
- 앱 내부에 AWS 키를 임베드하길 원치 않는 경우
- AWS 외부에서 이미 본인의 신분을 확인시켜준 사용자에게 AWS 접근 권한을 부여하려는 경우
- 제 3자에게 계정에 대한 접근권한을 부여하려는 경우
- 특정 애플리케이션이 이미 다른 AWS 서비스를 사용할 수 있는 경우
- 특정 임무만을 수행하기 위해 임시 보안 승인 정보를 요청하는 경우

> 두 개의 정책

롤을 생성하려면 두 개의 정책을 작성해야 한다.

첫 번째 정책은 누가 롤, 즉 역할을 맡을 것인가에 대한 것으로 이를 신뢰 정책이라 부른다.

두 번째 정책은 접근 승인 정책 또는 접근 권한 정책으로 부르며, 어떤 역할을 맡은 사용자에게 어떤 리소스 또는 액션을 접근하게 할 것인지 정의하는 것이다.

이때 역할의 주체는 서드 파티 유저, EC2 또는 DynamoDB와 같은 AWS 서비스, 보안 신분 제공자등 해당 역할을 맡게 될 누구든, 어떤 개체든 될 수 있고, 심지어 다른 계정의 IAM 유저도 가능하다.

### IAM 권한의 계층(Hierarchy of Privileges)

AWS 유저를 권한의 계층으로 구분해야 하는 경우 아래와 같이 가장 권한이 높은 유저를 맨 앞에 놓고 가장 권한이 낮은 유저를 맨 뒤에 놓는 순서를 따른다.

- AWS 루트 유저 또는 계정 소유자 : 모든 서비스와 리소스에 대한 무제한의 접근 권한 보유
- AWS IAM 유저 : 제한된 권한 보유, 그룹과 유저 정책에 의해 제한 받음
- 임시 보안 자격 정보 보유자 : 신분 확인 후 접근이 제한되고, 토큰 생성 등에 대한 정책으로 추가 제한됨.

### IAM 활용 베스트 프랙티스

1. IAM 유저 활용

루트 유저는 프로그래밍 기법의 호출 또는 요청을 위해 결코 사용하지 않아야 한다. AWS 계정에 대한 접근이 필요한 다른 사용자가 있다면 IAM 유저를 생성해 제공한다.

2. 강력한 패스워드 정책 수립

강력한 패스워드 정책을 수립하고 90일 경과한 패스워드는 폐기한다.
패스워드에는 최소 하나의 대문자, 소문자, 기호문자, 숫자가 포함되게 하고, 최소 8자에서 10자 이상이 되도록 한다.

3. 정기적으로 보안 자격 정보 갱신

Access Key Last Used 기능을 이용해 90일 이상 사용되지 않은 보안 자격 정보를 찾고, 비활성화시키고, IAM 유저의 보안 자격은 순회 갱신한다.

4. MFA 활용

슈퍼유저 권한의 계정에 MFA (멀티팩터인증)을 적용해 보안 레이어를 추가하면 좀 더 안전하게 계정을 보호할 수 있다.

5. 그룹으로 승인 관리

개별 유저마다 승인 권한을 할당하는 대신 연관 업무별로 그룹을 생성해 정책 규정을 할당하는 것이 좋다. 

6. 최소한의 권한 부여

항상 최소한의 권한을 제공하고 필요 시마다 승인을 추가해야 한다.

7. IAM 롤 활용

서로 다른 계정 간의 접근 권한 부여 시, 계정 내에서의 접근 권한 부여 시, 그룹 유저에게 접근 권한 부여 시 항상 IAM 롤을 사용한다.

8. Amazon EC2 인스턴스를 위한 IAM 롤 활용

Amazon EC2 인스턴스에서 실행되는 애플리케이션이 있고, 이 애플리케이션이 다른 AWS 서비스에 접근해야 하는 경우 애플리케이션 보안 자격 정보를 제공해야 한다.

EC2 인스턴스에서 실행되는 애플리케이션에 보안 자격을 부여하려 할 때 IAM 롤을 활용한다.

9. 보안 강화를 위한 IAM 정책 조건 수립

IAM 정책으로 특정 리소스에 대한 접근을 통제할 수 있는데, 정책 조건을 이용하면 접근 권한에 대한 세부적인 규칙을 추가할 수 있다.

10. AWS CloudTrail 활용

AWS 생태계에서 감사의 중요성은 매우 크므로 모든 리전에서 AWS CloudTrail 의 로그 파일 검증 기능을 활성화시키는 것이 좋다.

### AWS 보안 규정 프로그램

AWS 보안 규정 프로그램은 고객으로 하여금 AWS 클라우드 내에서 보안 유지 및 데이터 보호가 어떻게 이뤄지는지 잘 이해할 수 있도록 해준다.
이 프로그램은 AWS 클라우드 인프라 위에 마련돼 있으며, 보안 규정에 따른 책임이 효과적으로 공유될 수 있다.

### AWS 공유 책임 모델(Shared Responsibility Model)

AWS가 준수하는 공유 보안 책임 모델에는 AWS가 책임을 지는 부분과 AWS의 고객인 기업이 책임지는 부분이 명확히 구분돼 있다.

AWS는 클라우드의 보안을 책임지고, 고객은 클라우드 내의 보안을 책임지게 된다.

> 보안에 대한 AWS 측의 책임

1. 데이터 센터에 대한 물리적 보안
2. Amazon EC2 보안
3. 네트워크 보안
4. 환경 설정 관리
5. 고가용성 데이터 센터
6. 디스크 관리
7. 스토리지 디바이스 폐기

> 보안에 대한 고객측의 책임

1. 운영체제

게스트 OS의 관리에 대한 책임을 부담한다,

2. 애플리케이션
3. 방화벽
4. 네트워크 환경 설정
5. 서비스 환경 설정
6. 자격 인증 및 계정 관리

### AWS 보안 제품 및 서비스

(출제빈도는 낮다..)

> Resource Access Manager

Resource Access Manager를 이용해 AWS 리소스를 다른 계정 또는 AWS Organizations 를 통해 연결된 계정과 공유할 수 있다.

정책 및 퍼미션을 이용해 고수준의 보안 통제 권한을 확보하고 리소스에 대한 세분화된 감사 업무도 수행할 수 있다.

> AWS Secrets Manager

기업 조직 내 보안 업무에 공통적인 어려움은 기업 비밀을 관리하는 일이다.

사용자에 의한 기업 비밀 관리, 인출, 데이터베이스 접근 권한 및 API 키의 순회 변경, 기업 비밀의 생애주기 관리등 업무를 지원한다.

> Amazon GuardDuty

지능형 보안 위협 감지 서비스로 AWS 계정과 이에 연동된 애플리케이션 및 서비스를 모니터링하고 이미 알려진 보안 위협 및 미지의 보안 위협으로 부터 보호하며, 인공지능과 머신러닝을 통해 보안 위협에 대해 지능적으로 대처한다.

> Amazon Inspector

EC2 인스턴스의 잠재적인 보안 및 환경 설정 문제를 진단하는 서비스로 버전, 패치 레벨, 환경 설정 내역, 운영체제 및 애플리케이션의 작동 환경과 관련된 수천 가지의 침해 시도 및 보안 위협 노출 시도를 확인한다.

> Amazon Macie

Amazon S3에 저장된 데이터를 보호하며, S3에 저장된 데이터의 종류, 사업적 가치, 해당 데이터에 대한 접근과 관련된 행동에 따라 데이터를 분류 한다.

> AWS Certificate Manager

AWS 서비스 이용을 위한 Secure Sockets Layer (SSL) 인증서를 관리하며, 이를 통해 TLS 인증서를 프로비전, 관리, 배포할 수 있고 웹 사이트를 안전하게 관리할 수 있다.

> AWS Web Application Firewall

웹 어플리케이션에 대한 악성 트래픽을 감지할 수 있는 방화벽이다.

> AWS Shield

웹 어플리케이션에 대한 DDoS 공격에 대응하기 위한 관리형 서비스로 Standard 와 Advanced 두 가지 티어를 제공한다.

> AWS CloudHSM

AWS 클라우드 내에서 전용 하드웨어 보안 모듈을 통해 고객과의 계약 준수를 위해 요구되거나 법규 준수에 필요한 보안 수준을 제공한다.

> AWS KMS

암호화 작업용 키 생성 및 제어를 위한 관리형 서비스로 단일 제어 지점에서 다수의 AWS 통합 서비스 및 애플리케이션을 이용하기 위한 키를 관리하고 일관된 정책을 유지할 수 있다.

1. B
2. B,C
3. A
4. A,B
5. B,D
- 왜 A는 임시가 아니지??
6. C
7. C
8. A,C
9. A,D
10. B










