# AWS 공인 솔루션스 아키텍트 올인원 어소시에이트

## 3장. Amazon Virtual Private Cloud (VPC)

Amazon VPC 는 사용자를 위한 Virtual Private Cloud 서비스로 클라우드를 퍼블릭과 프라이빗 영역으로 논리적으로 분리할 수 있게 해준다.

어떤 리소스도 논리적으로 분리된 영역에 격리할 수 있으며, 네트워크에 대한 완전한 통제권을 가질 수 있다.

아마존 VPC는 기업의 클라우드 데이터 센터 구현 체계이며, VPN, Direct Connect 등과 결합하면 기존 데이터 센터를 클라우드로 확장할 수 있다. 


Amazon VPC 를 통해 네트워크 환경 설정에 대한 완전한 통제권을 가지게 되며, 자체 IP 주소, 자체 IP 범위, 프라이빗 및 퍼블릭 서브넷, 라우트 테이블, 네트워크 게이트웨이 등 모든 기능을 활용할 수 있다.

> VPC 활용 케이스

1. 애플리케이션 중 일부는 VPC 내 클라우드에서 실행하고, 일부는 온프레미스에서 실행할 수 있다.


2. VPC 내에서 다수의 서브넷을 생성할 수 있다. 인터넷 접근을 위한 퍼블릭 서브넷을 생성하고, 격리된 접근을 위한 프라이빗 서브넷을 생성할 수 있다.


3. Direct Connect 을 이용해 기업 데이터 센터와 VPN을 전용 회선으로 연결할 수 있고, 암호화된 IPsec 연결을 통해 하드웨어 기반으로 VPN으로 기업 데이터 센터를 연결할 수 있다.


4. 하나 이상의 VPC가 필요하다면 다수의 VPC를 생성한 뒤 VPC 피어링을 통해 서로 연결할 수 있다.


5. VPC 엔드포인트를 사용해 S3와 같은 리소스에 연결할 수 있다.

### Amazon VPC 구성 요소와 주요 용어

VPC가 없다면 수천 대 서버의 IP 네임스페이스를 관리하는 데만 많은 비용과 노력을 투입해야 할 것 이다.

> Amazon VPC

Amazon VPC는 클라우드 내 프라이빗 공간을 제공한다. VPC를 생성하면 클라우드에 기업 전용 데이터 센터를 구축할 수 있게 된다.


VPC 생성의 첫 번째 단계는 CIDR(Classless Inter-Domain Routing) 블록을 이용한 CIDR 범위 결정이다. 현재 VPN는 IPv4 및 IPv6 모두를 지원하며, 사용자는 어느 쪽이든 사용할 수 있다.


한번 생성된 VPC는 주소의 크기를 변경할 수 없다는 점에 주의한다. VPC를 생성해 사용하다가 더 큰 주소가 필요하면 새로운 VPC를 생성해야 하고, 이에 따라 애플리케이션도 마이그레이션하는 불편함이 발생할 수 있다.


VPC는 리전에 제한되고, 다른 리전으로 확장할 수 없으며 VPC 내에서 동일 리전의 AZ를 포함시킬 수 있다.


> 서브넷

서브넷은 서브네트워크의 줄임말로 IP 네트워크의 논리적인 하위 부분을 가리킨다. 서브넷을 통해 하나의 네트워크를 여러 개로 나눌 수 있다.

VPC를 이용하면 퍼블릭 서브넷, 프라이빗 서브넷, VPN 온리 서브넷 등 필요에 따라 다양한 서브넷을 생성할 수 있다.

퍼블릭 서브넷은 인터넷을 통해 연결할 수 있는 리소스를 위한 것이고, 프라이빗 서브넷은 인터넷으로 연결하지 않고 보안 유지를 위한 배타적인 연결에 사용하며,

VPN 온리 서브넷은 기업 데이터 센터와 VirtualPrivate Cloud 를 연결 하는데 사용한다. 

또한 워크로드의 유형에 따라 격리가 필요한 경우 서브넷을 생성 하며, 개발 환경을 위한 서브넷, 생산환경을 위한 서브넷 등이있다.

VPC의 CIDR 블록을 이용해 서브넷을 정의할 수 있다. VPC로 정의할 수 있는 최소크기의 서브넷은 /28이며, 이는 16개의 IP 주소를 생성할 수 있다.

서브넷은 AZ 당 하나만 사용할 수 있고, 여러 개의 AZ에 연결되는 서브넷은 만들 수 없다는 것이다.

하나의 VPC에 세 개의 AZ가 있는 경우, 각각의 AZ마다 별도의 서브넷을 생성해야하며, AZ1 ~ 3 용 Subnet 등과 같다.

물론 하나의 AZ에 여러 개의 서브넷을 생성하는 것은 가능하지만 VPC는 리전 단위로 생성되므로 하나의 VPC를 여러 개의 리전으로 확장할 수 없다.

다음은 서브넷의 대표적인 유형이다.

- 서브넷은 AZ 단위로 생성된다. 여러 개의 AZ 가 있다면 여러 개의 서브넷을 생성한다.
- VPC는 리전 단위로 생성된다. 여러 개의 리전이 있다면 여러 개의 VPC를 생성한다.

> 라우트 테이블

라우트 테이블은 트래픽의 전송 방향을 결정하는 라우트와 관련된 규칙을 담은 테이블이며, 목적지를 향한 최적의 경로로 데이터 패킷을 전송하기 위한 모든 정보를 담고 있다.

모든 서브넷은 라우트 테이블을 지닌다. 예를 들어, 특정 VPC의 서브넷이 라우트 테이블에 인터넷 게이트웨이를 포함하고 있다면, 해당 서브넷은 인터넷 액세스 권한 및 정보를 지닌다.
반대로 서브넷에 인터넷 게이트웨이 정보가 없다면, 해당 서브넷과 연결된 서버로는 인터넷에 접속할 수 없다.

하나의 라우트 테이블 규칙을 여러 개의 서브넷에 연결하는 것은 가능하다. 서브넷을 생성하고 별도의 라우트 테이블을 생성하지 않으면 클라우드가 자동으로 VPC의 메인 라우트 테이블을 연결한다.

VPC의 기본 라우트 테이블은 자동으로 생성되며 내용을 수정할 수 없다. VPC는 생성될 때 외부로 드러나지 않는 라우터를 부여받는다. 

라우트 테이블은 대상 주소와 대상, 두 가지 정보로 구성된다. 대상은 트래픽이 향하는 장소고, 대상 주소는 대상으로 향하는 IP 범위를 지정한다.

- 대상이 Local 인 케이스(10.0.0.0/16 or 2011:..)는 트래픽이 해당 CIDR 블록의 IPv4 및 IPv6 주소를 위한 VPC 내부로 향한다는 의미다.


- pcx-id2efl2c 인 케이스는 VPC 피어링 옵션으로 트래픽이 172.31.0.0/16 CIDR 블록을 지닌 또 다른 VPC로 이동할 수 있다.


- 0.0.0.0/0 범위의 IP 주소를 할당하면, 모든 IPv4 트래픽이 인터넷 게이트웨이로 이동할 수 있다.


- ::/0 범위의 IP 주소를 할당하면, 모든 IPv6의 모든 트래픽이 외부 전용 인터넷 게이트웨이로 이동할 수 있다.

> 인터넷 게이트웨이

VPC가 인터넷으로 연결되도록 하는 요소다.

VPC에 IG를 붙이면 라우트 테이블에 정의된 IG를 통해 서브넷에서 인터넷으로 바로 연결할 수 있다. 

> 네트워크 주소 변환 (NAT)

NAT 디바이스를 이용하면 기본적으로 인터넷 접속 불능으로 설정된 프라이빗 서브넷에 있는 서버 인스턴스를 인터넷에 연결할 수 있다.


NAT 디바이스는 프라이빗 서브넷에 있는 서버 인스턴스의 트래픽을 인터넷으로 보내고 그에 따른 응답을 다시 해당 인스턴스로 받을 수 있다. 

네트워크 주소 변환기 라고 불리며, NAT 기기는 IPv4 트래픽에만 사용할 수 있고, IPv6용으로 사용할 수 없다.

AWS의 NAT 기기는 아래 두 가지 타입이다.

• NAT 인스턴스

퍼블릭 서브넷에서 NAT 인스턴스를 이용할 때는 프라이빗 서브넷에서 인터넷 또는 다른 AWS로 트래픽을 보낼 수 있다. 

예를 들어, 퍼블릭과 프라이빗 두 개의 서브넷이 있고, 퍼블릭 서브넷에서 웹 서버를, 프라이빗 서브넷 에서 데이터베이스를 실행한다고 하자. 

데이터베이스 패치 등의 작업을 위해 데이터 베이스가 있는 프라이빗 서브넷에 인터넷을 연결하려면 퍼블릭 서브넷의 NAT 인스턴스가 필요하다. 

이렇게 하면 인터넷 트래픽은 퍼블릭 서브넷의 NAT 인스턴스를 통해 데이터베이스 서버로 전송될 수 있다. 

데이터베이스 서버는 NAT 인스턴스를 통해 인터넷과 연결될 수 있지만 반대 방향의 트래픽 이동은 불가능하다.

NAT 인스턴스가 다운되면 데이터베이스 서버의 인터넷 연결이 끊어진다. 

NAT 인스턴스가 단일 실패 지점(SPOF)이 되는 셈이다.

이와 같은 문제를 피하고자 다른 AZ에 NAT 인스턴스를 중복구현하거나, 서로 다른 AZ에서 액티브 및 패시브 모드로 NAT 인스턴스를 실행하거나, NAT 인스턴스 모니터링 스크립트를 실행해 하나의 인스턴스가 실패하면 곧바로 다른 인스턴스를 가동한다. 

하지만 이러한 기법은 많은 관리상의 노력과 시간, 비용이 소모되므로 결코 쉬운 일은 아니다. 

이와 같은 불편함을 해소하기 위해 AWS에서 제공히는 서비스가 NAT 게이트웨이다.

• NAT 게이트웨이

NAT 게이트웨이는 기본적으로 NAT 인스턴스와 동일한기능을 수행하지만 NAT 인스턴스가 하지 못하는 일을 할 수 있다. 

또한 완전 관리형 서비스이므로 고정적인 어드민 작업 부담이 줄어든다.

NAT 게이트웨이를 사용하려면 가장 먼저 일래스틱 IP 주소부터 설정한다. 

NAT 게이트웨이는 특정 AZ에 이중화 또는 중복 구현 방식으로 생성된다. 앞서 살펴본 NAT 인스턴스 예제에서 소개한 데이터베이스 서버에 NAT 게이트웨이를 부착하면 인터넷에 연결할 수 있으며, 프라이빗 서브넷의 라우트 테이블 엔트리에는 NAT 인스턴스 대신 NAT 게이트웨이를 추가하면 된다.

실무에서는 NAT 인스턴스보다 NAT 게이트웨이를 선호하는데, 이는 NAT 게이트웨이의 가용성 및 네트워크 대역이 보다 높기 때문이다. 

• 외부 전용 인터넷 게이트웨이

VPC 컴포넌트 중 하나인 외부 전용 인터넷 게이트웨이는 NAT 게이트웨이와 비슷한 기능을 수행하며 IPv6 기반 인터넷 트래픽의 이동을 담당한다.

외부 전용는 IPv6 서브넷 내부에서 외부로 나가는 아웃비운드만 가능하다는 뜻이다. 

** NAT 인스턴스, NAT 게이트웨이, 외부 전용 인터넷 게이트웨이 모두 (네트원크 연결상태 정보를 제공할 수 있는) 스테이트풀(Stateful) 속성을 지닌다.

> 탄력적 네트워크 인터페이스

탄력적 네트워크 인터페이스(ENI)는 하나 혹은 다수의 네트워크 인터페이스를 생성하고 인스턴스에 붙이는 역할을 담당한다.

그리고 필요하면 언제든 인스턴스에서 네트워크 인터페이스를 분리하고, 해당 인스턴스나 다른 인스턴스에 다시 붙일 수 있다. 

특정 인스턴스를 가리키던 네트워크 인터페이스를 다른 인스턴스로 이동시키면 네트워크 트래픽은 새로운 인스턴스를 가리키게 된다.

ENI는 아마존 VPC에서 인스턴스에 부착 및 분리할 수 있는 버추얼 네트워크 인터페이스이며, 주요 속성은 다음과 같다.

1. MAC주소

2. 하나의 퍼블릭 IPv4주소

3. 하나 또는 그이상의 IPv6주소

4. 프라이머리 프라이빗 IPv4주소

5. 하나 또는 그 이상의 세컨더리 프라이빗 IPv4주소

6. 프라이빗 IPv4주소별 일래스틱 IP 주소(IPv4)

7. 인스턴스를 론칭할때 네트워크 인터페이스 eth0에 자동으로 할당될 수 있는 하나의 퍼블릭 IPv4 주소

8. 하나 또는 그 이상의 시큐리티그룹 

9. 소스/대상 주소 체크 플래그 및 명세

> Linux에서 향상된 네트워킹(리눅스만 가능)

Linux에서 향상된 네트워킹은 애플리케이션 실행에 있어 매우 낮은 지연성, 광대역폭,고속PPS 성능이 요구되는 경우에 사용할 수있다.

Linux에서 향상된 네트워킹은 인스턴스 타입에 따라 다음 두 가지 방식으로 사용할 수 있다.

1. Elastic Network Adapter(ENA)를 사용하는 경우, ENA는 지원 인스턴스 타입에 따라 최대 100Gbps의 네트워크를 지원한다. 
2. Intel82599VirtualFunction(VF)인터페이스를 사용하는경우 VF는 지원 인스턴스 타입에 따라 최대 lOGbps의 네트워크를 지원한다.

> 일래스틱 IP 주소

일래스틱 IP 주소(EIP)는 클라우드에서 실행되는 애플리케이션을 위한 주소 체계다.

AWS에서 새로운 EC2 인스턴스를 생성할 때 마다 새로운 IP 주소가 만들어진다.
하지만 애플리케이션을 업데이트할 때마다 그에 맞춰 IP 주소를 변경하는 일은 결코 쉽지 않다. 

따라서 애플리케이션을 업데이트할 때마다 IP 주소를 비꾸는 대신 EIP를 받아서 해당 EC2 인스턴스와 연결하고, 이 EIP를 애플리케이션에 연결하는 방식이 자주 사용 된다. 


EIP는 정적 IP 주소이며 애플리케이션에 정적 IP 주소가 필요하다면 EIP를 사용하면 된다.

현 시점에서 EIP는 IPv4만 지원하고 IPv6는 지원하지 않는다. 또 EIP는 퍼블릭 IPv4 IP 주소이므로 인터넷과 바로 연결될 수 있다. 

> 네트워크 보안

VPC에서 네트워킹을 통해 실행되는 리소스의 보안을 유지하는 일은 매우 중요하다.

네트워크 보안은 시큐리티 그룹 및 네트워크 접근 목록 (NACL)을 통해 구현할 수 있다.

> 시큐리티 그룹

VPC에서 실행되는 어떤 인스턴스에도 할당할 수 있는 가상 방화벽과 같으며, 특정 인스턴스의 내부 또는 외부로 이동하는 트래픽을 정의한다. 

시큐리티 그룹은 인스턴스 단위로 할당되기 때문에 인스턴스마다 새로운 시큐리티 그룹를 추가해야 하며, 서브넷 레벨이 아닌 인스턴스 레벨에서 작동한다는 점에 주의한다.

시큐리티 그룹은 스테이트풀 속성을 지니며 IP 주소, 포트, 트래픽의 인비운드 및 아웃바운드에 대한 규칙을 정의한 프로토콜 등으로 구성된다.

> 네트워크 액세스 제어 목록

VPC의 서브넷 레벨에 적용할 수 있는 추가적인 방화벽인 네트워크 네트워크 액세스 제어 목록(NACL)을 알아본다. 

NACL은 서브넷 레벨에서 작동하며 필요에 따라 선택 할 수 있는 옵션의 성격을 지닌다.

한 마디로 NACL은 IP 주소, 포트, 프로토콜, 서브넷 허용/거부 규칙을 통합한 스테이트리스 속성의 방화벽 서비스다.

시큐리티 그룹과 NACL은 디음과 같은 차이점이 있다.

- 시큐리티 그룹은 인스턴스 레벨에 적용되고, NACL은 서브넷 레벨에 적용된다. 따라서 서브넷 내에 10개의 인스턴스가 있다면 NACL 규칙은 10개의 인스턴스 모두에게 적용된다.
- 시큐리티 그룹은 스테이트풀(리턴트래픽을 기본적으로 허용), NACL은 스테이트리스(리턴트래픽을 기본적으로 거부) 속성을 지닌다.
- 시큐리티 그룹은 허용 규칙만 추가 할 수 있지만,NACL은 허용 및 거부 모두 추가할 수 있다.
- 시큐리티 그룹의 모든규칙은 트래팍 허용 전에 평가 받지만, NACL은 순번에 따른 우선순위로 평가받는다.

> Amazon VPC 피어링

VPC 피어링은 하나의 VPC를 또 다른 VPC에 연결하고,프라이빗 IPv4 또는 IPv6 주소를 통해 서로의 트래픽을 교환하기 위한 방법이다.

VPC 피어링이 실행되면, 양쪽의 VPC에서 실행되는 인스턴스는(통일한 네트워크에만 있다면) 서로 소통할 수 있다. 

VPC 피어링은 동일 리전에서만 가능하며, 리전 간의 피어령은 불가능하다. 

하나의 계정에서 여러 개의 VPC를 피어링할 수 있고 서로 다른 계정 간에도 VPC 피어링을 할 수 있다. 

> Amazon VPC 엔드포인트

S3를 VPC와 연결하려면 인터넷과 데이터 센터 전용 네트워크 두 개를 함께 연결해야 한다. 

VPC 엔드포인트는 이런 목적으로 만들어졌으며, S3와 VPC를 프라이빗하게 연결한다.

결국 어떤 트래픽도 아마존 네트워크를 벗어나지 않게 된다. 

VPC 엔드포인트는 수평적 확장성, 중복구현성, 고가용성을 제공히는 가상 기기로 VPC 엔드포인트를 사용할 때는 앞서 설명한 퍼블릭 IPv4 주소, 인터넷게이트웨이, NAT 디바이스 및 게이트웨이,VPG 등이 없어도 무방하다.

- AWS PrivateLink

고객이 AWS 서비스를 신속하게 접근하고 확장할 수 있게 하는 도구로 모든 네트워크 트래픽을 AWS 내부에서 처리한다.

PrivateLink를 사용하는 AWS 서비스의 엔드포인트를 생성하면, 이들 서비스의 엔드포인트는 VPC에 프라이빗 IP를 지닌 ENI로 표시된다. 
PrivateLink를 이용하면 퍼블릭 IP의 화이트리스트를 작성하거나 AWS 서비스를 연결하는 인터넷 게이트웨이, NAT 기기 또는 방화벽 프록시를 관리할 필요가 없다.

VPC 엔드포인트는 인터페이스 엔드포인트, 게이트웨이 엔드포인트 등, 두 가지 유형이 있다.

1. 인터페이스 엔드포인트는 프라이빗 IP 주소를 지닌 ENI로 제공하는 서비스의 트래픽을 처리하는 엔트리 포인트가 되는 서브넷의 IP 주소를 사용한다. 
현재 50여개 이상의 서비스가 인터페이스 엔드포인트를 지원하고 있으며, AWS 관리형 서비스, 자체 Amazon VPC를 사용해 호스팅 하는 AWS 고객 및 파트너의서비스(엔드포인트서비스로지칭), AWSMarketplace 서비스등이 포함된다.

2. 게이트웨이 엔드포인트는 AWS 서비스의 트래픽을 정의하는 라우트 테이블에서 타깃으로 설정할 수 있으며, 집필 시점 현재, S3 및 DynamoDB가 게이트웨이 엔드포인트를 지원하고 있다.

> Transit Gateway

Transit Gateway를 이용하면 네트워크 전송 허브를 이용해 VPC와 온프레미스 네트워크를 연결할 수 있다. 
또한 네트워크 아키텍처를 간소화할 수 있고, 멀티 VPC 피 어링 환경에 대한 관리 부담도 줄어든다.

Transit Gateway는 VPC와 VPN 사이의 트래픽 흐름을 분산시키는 클라우드 라우터와 같은 역할을 수행하며, 트래픽에 따라 자동으로 확장되므로 기존의 수작업 또 한 줄일 수 있다.

Transit Gateway는 레이어 3 수준에서 라우팅하며, 패킷은 목적 IP 주소 기반의 next hop 장치로 전송된다.

> DNS와 VPC

DNS 서버는 도메인 네임 디렉터리를 관리하고 이를 IP 주소로 비꾸는 기능을 수행한다. 

대 부분의 인터넷 사용자는 숫자로 된 IP 주소가 아닌 기억하기 쉬운 인터넷 도메인 네임을 사용한다. 
DNS 호스트네임은 특정 컴퓨터만의 유일무이한 이름이며, 호스트네임과 도메인 네임으로 구성된다.

아마존의 DNS 서버는 VPC 내에서 실행 중인 모든 인스턴스의 주소를 관리하고, 퍼블릭 IPv4 주소는 인터넷을 통해 연결할 수 있으며, 프라이빗 IPv4 주소는 (VPC 내의) 내부 네트워크를 통해 연결할 수 있다. 

기본 설정 VPC 내에서 인스턴스를 실행하면 해당 인스턴스는 퍼블릭 IPv4 주소에 대응되는 퍼블릭 DNS 호스트네임을 지니고, 프라이빗 IPv4 주소에 대응되는 프라이빗 DNS 호스트네임을 지닌다는 사실을 알 수 있다.

> DHCP 옵션 세트

DHCP(Dynamic Host Configuration Protocol) 옵션 세트는 기본 도메인 네임, DNS 서버 등 VPC 에 있는 인스턴스의 호스트 환경 설정에 사용된다.

AWS는 AWS 디렉터리 서비스 사용 시 VPC 설정에서 DHCP 옵션 세트를 사용할 것을 권장한다. 이렇게 하면 VPC에 있는 모든 인스턴스는 해당 도메인 네임을 통해 특정 도메인 또는 DNS를 가리킬 수 있게된다.

> VPC에 연결하기

기업 데이터 센터와 VPC를 연결하면, VPC는 데이터 센터를 확장한 것과 같은 기능을 수행하며 VPC와 데이터 센터 간의 트래픽을 효과적으로 처리할 수 있다.

1. 버추얼 프라이빗 게이트웨이 

기본적으로 VPC에서 실행한 인스턴스는 자체 네트워크를 사용하는 기업 데이터 센터와 소통할 수 없다(퍼블릭 서브넷에서 실행되는 인스턴스 제외), 
기업 데이터 센터의 트래픽이 VPC에 닿을 수 없기 때문이며, 서로 소통할 수 있도록 하려면 VPC에 버추얼 프라이빗 게이트 웨이(VPG)를 부착한 뒤 커스텀 라우트 테이블을 작성하고, 시큐리티 그룹 규칙을 업데이트한다.


VPG는 아마존에서 제공히는 VPN 연결 서비스로 아마존 측의 트래픽을 관리하며, 커스토머 게이트웨이는 기업 데이터 센터 측의 트래픽을 관리한다.

2. 커스토머 게이트웨이

커스토머 게이트웨이는 기업 데이터 센터 측 또는 VPN 연결 부분에 있는 물리적 디바이스 또는 소프트웨어 애플리케이션이며, 기업 데이터 센터 측에서 연결된 부분의 앵커와 같은 역할을 담당한다.


VPC와 데이터센터를 연결하기 위한 네 가지 주요 프라이빗 연결 옵션은 아래와 같다.

1. AWS 하드웨어 VPN

VPC와 리모트 네트워크를 연결하기 위해 하드웨어 VPN 연결인 IPsec을 생성할 수 있다.

IPsec은 Internet Protocol Security를 의미하며, 커뮤니케이션 세션에서 각각의 IP 패킷을 인증하고 암호화하는 IP 커뮤니케이션용 프로토콜이다. 

AWS 측의 VPN 연결에서 VPG는 자동페일오버를 대비해 두 개의 VPN 엔드포인트를 제공한다. 

사용자는 원격 접속 측의 VPN 연결용 디바이스 또는 소프트웨어인 커스토머 게이트웨이의 환경 설정을 할 수있다.

AWS는 정적 및 동적 BGP(Border Gateway Protocol) 연결 및 VPN 연결을 지원한다.

BGP를 사용할 수 있다면 프리픽스라 부르는 IP 라우트를 동적으로 변경할 수 있으며, 기업 네트워크 환경이 변하면 자동으로 해당 내용이 적용된다. 

모든 VPN 연결은 두 개의 IPsec 터널로 프로비전되고, 서로 다른 두 개의 AZ에서 소멸된다.

2. AWS Direct Connect

AWS Direct Connect는 기업 데이터 센터에서 VPC로 연결되는 전용 프라이빗 연결 서비스로 각 AWS 리전은 최소 하나이상의 Direct Connect 로케이션과 연결된다. 

Direct Connect를 이용하면 일관된 네트워크성능을 확보할 수있다.IPsec 암호화 연결을 생성하기 위해서는 AWS Hardware VPN 연결을 이용해야한다.

3. VPN CloudHub

하나 이상의 원격 네트워크가 있다면 (예를 들어, 지사가 있다면) VPC를 통해 여러 개의 AWS Hardware VPN 연결을 생성해 커뮤니케이션 할 수 있다. 

AWS VPN 클리우드 CloudHub를 이용하면 여러 개의 사이트에서 VPN에 접근할 수 있고, 허브 앤 스포크 모델을 통해 보안성을 높여 접근 할 수 있다. 

4. Software VPN

Software VPN 장비가 부착된 VPC내의 EC2 인스턴스를 이용해 원격 네트워크로 연결되는 VPN 연결을 생성할 수 있다.

AWS 자체적으로는 Software VPN 장비를 제공하지 않지만, 관련 서비스를 제공히는 다수의 파트너 및 오픈소스 커뮤니티에서 구할 수 있고, 마켓플레이스에서도 Software VPN을 구할 수 있다.

> VPC 흐름 로그

VPC 흐름 로그는 VPC에서 네트워크 인터페이스로 들어오고 나가는 IP 트래픽에 대한 정보를 확인할 수 있도록 해주며,
흐름 로그 데이터는 Amazon CloudWatch로 그를 이용해 저장된다. 생성된 흐름 로그는 AWS CloudWatch 에서 확인할 수있다.

흐름 로그는 네트워크 인터페이스, 서브넷, VPC 트래픽 확인을 위해 사용 할 수 있다.

### 기본 설정 VPC

VPC는 모든 계정에서 리전별로 생성되며, 이를 기본 설정 VPC 또는 디폴트 VPC라 부른다. 

사용자가 이같은 기본 설정 VPC 사용을 원하지 않는 경우에도 기본 설정 VPC는 삭제할 수 없는데, 기본 설정 VPC가 없으면 여러가지 문제가 발생할 수 있기 때문이다. 

기본 설정 VPC는 다음과 같은 기능을 포함한 상태로 미리 생성된다.

- 다이나믹 프라이빗 IP 
- 다이나믹 퍼블릭 IP
- AWS 제공 DNS 네임
- 프라이빗 DNS 네임 
- 퍼블릭 DNS 네임

기본 설정 VPC로 다음과 같은 일을 할 수 있다.

- 서브넷 추가 생성 및 라우트 테이블 규칙 변경 
- 시큐리티그룹,NACL,라우팅등 네트워크 컨트롤 추가 생성 
- 기업 네트워크 간 Hardware VPN 옵션 설정


기본 설정 VPC에서 기본 서브넷의 인스턴스는 시큐리티 그룹에서 정의된 퍼블릭 및 프라이빗 IP를 지닌다.